<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Autumn Sample - javascript - catppuccin_latte (inline)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'JetBrains Mono', monospace;
      line-height: 1.5;
    }
    pre {
      font-size: 15px;
      margin: 20px;
      padding: 50px;
      border-radius: 10px;
    }
  </style>
  <style>
  /* catppuccin_latte */
pre.autumn-hl { background-color: #eff1f5; color: #4c4f69; }
.ahl-info { color: #04a5e5; }
.ahl-label { color: #209fb5; }
.ahl-markup.ahl-heading.ahl-marker { font-weight: bold; color: #fe640b; }
.ahl-markup.ahl-bold { font-weight: bold; }
.ahl-namespace { font-style: italic; color: #1e66f5; }
.ahl-keyword.ahl-control.ahl-conditional { font-style: italic; color: #8839ef; }
.ahl-markup.ahl-heading.ahl-1 { color: #7287fd; }
.ahl-constant.ahl-builtin { color: #fe640b; }
.ahl-markup.ahl-heading.ahl-6 { color: #179299; }
.ahl-attribute { color: #1e66f5; }
.ahl-type { color: #df8e1d; }
.ahl-diagnostic.ahl-warning { color: #df8e1d; }
.ahl-hint { color: #179299; }
.ahl-string.ahl-special { color: #1e66f5; }
.ahl-constant { color: #fe640b; }
.ahl-punctuation.ahl-special { color: #04a5e5; }
.ahl-warning { color: #df8e1d; }
.ahl-string.ahl-regexp { color: #fe640b; }
.ahl-variable { color: #4c4f69; }
.ahl-constructor { color: #209fb5; }
.ahl-markup.ahl-heading.ahl-2 { color: #8839ef; }
.ahl-keyword.ahl-storage.ahl-modifier.ahl-ref { color: #179299; }
.ahl-diagnostic.ahl-error { color: #d20f39; }
.ahl-diff.ahl-minus { color: #d20f39; }
.ahl-constant.ahl-character { color: #179299; }
.ahl-markup.ahl-raw { color: #dd7878; }
.ahl-tag { color: #8839ef; }
.ahl-comment { font-style: italic; color: #8c8fa1; }
.ahl-markup.ahl-link.ahl-text { color: #1e66f5; }
.ahl-punctuation { color: #7c7f93; }
.ahl-markup.ahl-italic { font-style: italic; }
.ahl-function.ahl-macro { color: #8839ef; }
.ahl-special { color: #1e66f5; }
.ahl-diff.ahl-plus { color: #40a02b; }
.ahl-operator { color: #04a5e5; }
.ahl-diagnostic.ahl-info { color: #04a5e5; }
.ahl-constant.ahl-character.ahl-escape { color: #ea76cb; }
.ahl-markup.ahl-link.ahl-url {  color: #dc8a78; }
.ahl-variable.ahl-builtin { color: #d20f39; }
.ahl-variable.ahl-parameter { font-style: italic; color: #e64553; }
.ahl-string { color: #40a02b; }
.ahl-diff.ahl-delta { color: #1e66f5; }
.ahl-keyword { color: #8839ef; }
.ahl-markup.ahl-heading.ahl-3 { color: #40a02b; }
.ahl-markup.ahl-heading.ahl-5 { color: #ea76cb; }
.ahl-markup.ahl-heading.ahl-4 { color: #df8e1d; }
.ahl-markup.ahl-list { color: #8839ef; }
.ahl-diagnostic.ahl-hint { color: #179299; }
.ahl-variable.ahl-other.ahl-member { color: #179299; }
.ahl-function { color: #1e66f5; }
.ahl-error { color: #d20f39; }

  </style>
</head>
<body>
  <pre class="autumn-hl"><code class="language-javascript" translate="no"><span class="ahl-keyword">import</span> <span class="ahl-punctuation ahl-bracket">{</span>
  <span class="ahl-variable">BEFORE_UNLOAD_LOADER_TIMEOUT</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">CHECKABLE_INPUTS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">CONSECUTIVE_RELOADS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_AUTO_RECOVER</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_COMPONENT</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_CONNECTED_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_DISABLE_WITH</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_DISABLE_WITH_RESTORE</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_EVENT_CLASSES</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_CLIENT_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_SERVER_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_FEEDBACK_FOR</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_FEEDBACK_GROUP</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_HAS_FOCUSED</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_HAS_SUBMITTED</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_PAGE_LOADING</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_PARENT_ID</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_PROGRESS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_READONLY</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_ROOT_ID</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_SESSION</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_STATIC</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_TRACK_STATIC</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_TRACK_UPLOADS</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_UPDATE</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_UPLOAD_REF</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_VIEW_SELECTOR</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_MAIN</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_MOUNTED</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PUSH_TIMEOUT</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_VIEWPORT_TOP</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">PHX_VIEWPORT_BOTTOM</span><span class="ahl-punctuation ahl-delimiter">,</span>
<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;constants&quot;</span>

<span class="ahl-keyword">import</span> <span class="ahl-punctuation ahl-bracket">{</span>
  <span class="ahl-variable">clone</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">closestPhxBinding</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">isEmpty</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">isEqualObj</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">maybe</span><span class="ahl-punctuation ahl-delimiter">,</span>
  <span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-delimiter">,</span>
<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;utils&quot;</span>

<span class="ahl-keyword">import</span> <span class="ahl-variable">Browser</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;browser&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">DOM</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;dom&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">DOMPatch</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;dom_patch&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">LiveUploader</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;live_uploader&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">Rendered</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;rendered&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">ViewHook</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;view_hook&quot;</span>
<span class="ahl-keyword">import</span> <span class="ahl-variable">JS</span> <span class="ahl-keyword">from</span> <span class="ahl-string">&quot;.&#x2f;js&quot;</span>

<span class="ahl-keyword">let</span> <span class="ahl-variable">serializeForm</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">metadata</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onlyNames</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
  <span class="ahl-keyword">const</span> <span class="ahl-punctuation ahl-bracket">{</span>submitter<span class="ahl-punctuation ahl-delimiter">,</span> ...<span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">metadata</span>

  <span class="ahl-comment">&#x2f;&#x2f; We must inject the submitter in the order that it exists in the DOM</span>
  <span class="ahl-comment">&#x2f;&#x2f; releative to other inputs. For example, for checkbox groups, the order must be maintained.</span>
  <span class="ahl-keyword">let</span> <span class="ahl-variable">injectedElement</span>
  <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">submitter</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>name<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">const</span> <span class="ahl-variable">input</span> <span class="ahl-operator">=</span> <span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">.</span>createElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;input&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>type <span class="ahl-operator">=</span> <span class="ahl-string">&quot;hidden&quot;</span>
    <span class="ahl-comment">&#x2f;&#x2f; set the form attribute if the submitter has one;</span>
    <span class="ahl-comment">&#x2f;&#x2f; this can happen if the element is outside the actual form element</span>
    <span class="ahl-keyword">const</span> <span class="ahl-variable">formId</span> <span class="ahl-operator">=</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;form&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formId</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;form&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">formId</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>name <span class="ahl-operator">=</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>name
    <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>value <span class="ahl-operator">=</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>value
    <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>parentElement<span class="ahl-punctuation ahl-delimiter">.</span>insertBefore<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">injectedElement</span> <span class="ahl-operator">=</span> <span class="ahl-variable">input</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  <span class="ahl-keyword">const</span> <span class="ahl-variable">formData</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">FormData</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-keyword">const</span> <span class="ahl-variable">toRemove</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>

  <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">val</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">key</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_index</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">val</span> <span class="ahl-keyword">instanceof</span> <span class="ahl-variable">File</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">toRemove</span><span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

  <span class="ahl-comment">&#x2f;&#x2f; Cleanup after building fileData</span>
  <span class="ahl-variable">toRemove</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">key</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">.</span>delete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>

  <span class="ahl-keyword">const</span> <span class="ahl-variable">params</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">URLSearchParams</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>

  <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">val</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-keyword">of</span> <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">onlyNames</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0 <span class="ahl-operator">||</span> <span class="ahl-variable">onlyNames</span><span class="ahl-punctuation ahl-delimiter">.</span>indexOf<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&gt;=</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-delimiter">.</span>append<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">val</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  <span class="ahl-comment">&#x2f;&#x2f; remove the injected element again</span>
  <span class="ahl-comment">&#x2f;&#x2f; (it would be removed by the next dom patch anyway, but this is cleaner)</span>
  <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">submitter</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">injectedElement</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">.</span>parentElement<span class="ahl-punctuation ahl-delimiter">.</span>removeChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">injectedElement</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">metaKey</span> <span class="ahl-keyword">in</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-delimiter">.</span>append<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">metaKey</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">metaKey</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  <span class="ahl-keyword">return</span> <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-delimiter">.</span>toString<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
<span class="ahl-punctuation ahl-bracket">}</span>

<span class="ahl-keyword">export</span> <span class="ahl-keyword">default</span> <span class="ahl-keyword">class</span> <span class="ahl-variable">View</span> <span class="ahl-punctuation ahl-bracket">{</span>
  constructor<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">liveSocket</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">parentView</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">flash</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">liveReferer</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDead <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket <span class="ahl-operator">=</span> <span class="ahl-variable">liveSocket</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>flash <span class="ahl-operator">=</span> <span class="ahl-variable">flash</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent <span class="ahl-operator">=</span> <span class="ahl-variable">parentView</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root <span class="ahl-operator">=</span> <span class="ahl-variable">parentView</span> ? <span class="ahl-variable">parentView</span><span class="ahl-punctuation ahl-delimiter">.</span>root : <span class="ahl-variable ahl-builtin">this</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el <span class="ahl-operator">=</span> <span class="ahl-variable">el</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>id
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>ref <span class="ahl-operator">=</span> 0
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>childJoins <span class="ahl-operator">=</span> 0
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>loaderTimer <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingDiffs <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingForms <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">Set</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent ? <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">-</span> 1 : 0
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinPending <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyed <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCallback <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">onDone</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>stopCallback <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent ? <span class="ahl-constant ahl-builtin">null</span> : <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formSubmits <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>children <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent ? <span class="ahl-constant ahl-builtin">null</span> : <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`lv:<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">}</span>`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">url</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>expandURL<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">{</span>
        redirect: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect ? <span class="ahl-variable">url</span> : <span class="ahl-constant ahl-builtin">undefined</span><span class="ahl-punctuation ahl-delimiter">,</span>
        url: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect ? <span class="ahl-constant ahl-builtin">undefined</span> : <span class="ahl-variable">url</span> <span class="ahl-operator">||</span> <span class="ahl-constant ahl-builtin">undefined</span><span class="ahl-punctuation ahl-delimiter">,</span>
        params: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>connectParams<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">liveReferer</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        session: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getSession<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        static: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getStatic<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        flash: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>flash<span class="ahl-punctuation ahl-delimiter">,</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  setHref<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">=</span> <span class="ahl-variable">href</span> <span class="ahl-punctuation ahl-bracket">}</span>

  setRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">=</span> <span class="ahl-variable">href</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>hasAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_MAIN</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  connectParams<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">liveReferer</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">params</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>params<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">manifest</span> <span class="ahl-operator">=</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_TRACK_STATIC</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>map<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">node</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">node</span><span class="ahl-punctuation ahl-delimiter">.</span>src <span class="ahl-operator">||</span> <span class="ahl-variable">node</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">url</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-keyword">typeof</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">url</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">===</span> <span class="ahl-string">&quot;string&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">manifest</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;_track_static&quot;</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">manifest</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;_mounts&quot;</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount
    <span class="ahl-variable">params</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;_live_referer&quot;</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">liveReferer</span>

    <span class="ahl-keyword">return</span> <span class="ahl-variable">params</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>canPush<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  getSession<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_SESSION</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  getStatic<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">val</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_STATIC</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">val</span> <span class="ahl-operator">===</span> <span class="ahl-string">&quot;&quot;</span> ? <span class="ahl-constant ahl-builtin">null</span> : <span class="ahl-variable">val</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  destroy<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">callback</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyAllChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyed <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-keyword">delete</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">delete</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable">clearTimeout</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>loaderTimer<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">onFinished</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">id</span> <span class="ahl-keyword">in</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>markPhxChildDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;destroyed&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;the child has been removed from the parent&quot;</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>leave<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;ok&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onFinished</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onFinished</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;timeout&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onFinished</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  setContainerClasses<span class="ahl-punctuation ahl-bracket">(</span>...<span class="ahl-variable">classes</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>classList<span class="ahl-punctuation ahl-delimiter">.</span>remove<span class="ahl-punctuation ahl-bracket">(</span>
      <span class="ahl-variable">PHX_CONNECTED_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
      <span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
      <span class="ahl-variable">PHX_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
      <span class="ahl-variable">PHX_CLIENT_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span>
      <span class="ahl-variable">PHX_SERVER_ERROR_CLASS</span>
    <span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>classList<span class="ahl-punctuation ahl-delimiter">.</span>add<span class="ahl-punctuation ahl-bracket">(</span>...<span class="ahl-variable">classes</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  showLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">timeout</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">clearTimeout</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>loaderTimer<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">timeout</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>loaderTimer <span class="ahl-operator">=</span> <span class="ahl-variable">setTimeout</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>showLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">timeout</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">id</span> <span class="ahl-keyword">in</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>__disconnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>setContainerClasses<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  execAll<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">binding</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">binding</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>execJS<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">binding</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  hideLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">clearTimeout</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>loaderTimer<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>setContainerClasses<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_CONNECTED_CLASS</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>execAll<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;connected&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  triggerReconnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">id</span> <span class="ahl-keyword">in</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>__reconnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">msgCallback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">msgCallback</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  transition<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">time</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onStart</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onDone</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>transition<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">time</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onStart</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  withinTargets<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span> <span class="ahl-keyword">instanceof</span> <span class="ahl-variable">HTMLElement</span> <span class="ahl-operator">||</span> <span class="ahl-variable">phxTarget</span> <span class="ahl-keyword">instanceof</span> <span class="ahl-variable">SVGElement</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>owner<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">view</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">targets</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findComponentNodeList<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targets</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`no component found matching phx-target of <span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">}</span>`</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">parseInt</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">targets</span> <span class="ahl-operator">=</span> <span class="ahl-variable">Array</span><span class="ahl-punctuation ahl-delimiter">.</span>from<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">.</span>querySelectorAll<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targets</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`nothing found matching the phx-target selector &quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxTarget</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;`</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-variable">targets</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">target</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>owner<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">target</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">view</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">target</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  applyDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">type</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">rawDiff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">type</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">clone</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">rawDiff</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> reply<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-delimiter">,</span> title<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">Rendered</span><span class="ahl-punctuation ahl-delimiter">.</span>extract<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">rawDiff</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> reply<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">title</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">.</span>requestAnimationFrame<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>putTitle<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">title</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onJoin<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">{</span>rendered<span class="ahl-punctuation ahl-delimiter">,</span> container<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">resp</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">container</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">tag</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">attrs</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">container</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>replaceRootContainer<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">tag</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">attrs</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>childJoins <span class="ahl-operator">=</span> 0
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinPending <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>flash <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">null</span>

    <span class="ahl-variable">Browser</span><span class="ahl-punctuation ahl-delimiter">.</span>dropLocal<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>localStorage<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">.</span>location<span class="ahl-punctuation ahl-delimiter">.</span>pathname<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">CONSECUTIVE_RELOADS</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;mount&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">rendered</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">Rendered</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>renderContainer<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;join&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>dropPendingRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">forms</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formsForRecovery<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">return</span> <span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingForms<span class="ahl-punctuation ahl-delimiter">.</span>has<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount<span class="ahl-operator">++</span>

      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">forms</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">forms</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">i</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingForms<span class="ahl-punctuation ahl-delimiter">.</span>add<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushFormRecovery<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingForms<span class="ahl-punctuation ahl-delimiter">.</span>delete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">i</span> <span class="ahl-operator">===</span> <span class="ahl-variable">forms</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">-</span> 1<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
              <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onJoinComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-punctuation ahl-bracket">}</span>
          <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onJoinComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  dropPendingRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-bracket">}</span>=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">}</span>&quot;][<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onJoinComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>live_patch<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-comment">&#x2f;&#x2f; we can clear pending form recoveries now that we&#x27;ve joined.</span>
    <span class="ahl-comment">&#x2f;&#x2f; They either all resolved or were abandoned</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingForms<span class="ahl-punctuation ahl-delimiter">.</span>clear<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-comment">&#x2f;&#x2f; In order to provide a better experience, we want to join</span>
    <span class="ahl-comment">&#x2f;&#x2f; all LiveViews first and only then apply their patches.</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">&gt;</span> 1 <span class="ahl-operator">||</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-delimiter">.</span>isJoinPending<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyJoinPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-comment">&#x2f;&#x2f; One downside of this approach is that we need to find phxChildren</span>
    <span class="ahl-comment">&#x2f;&#x2f; in the html fragment, instead of directly on the DOM. The fragment</span>
    <span class="ahl-comment">&#x2f;&#x2f; also does not include PHX_STATIC, so we need to copy it over from</span>
    <span class="ahl-comment">&#x2f;&#x2f; the DOM.</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">newChildren</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findPhxChildrenInFragment<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">toEl</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">fromEl</span> <span class="ahl-operator">=</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>querySelector<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`[id=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">}</span>&quot;]`</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">phxStatic</span> <span class="ahl-operator">=</span> <span class="ahl-variable">fromEl</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_STATIC</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxStatic</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_STATIC</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxStatic</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-comment">&#x2f;&#x2f; set PHX_ROOT_ID to prevent events from being dispatched to the root view</span>
      <span class="ahl-comment">&#x2f;&#x2f; while the child join is still pending</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_ROOT_ID</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">newChildren</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyJoinPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-delimiter">.</span>ackJoin<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onAllChildJoinsComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyJoinPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyJoinPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  attachTrueDocEl<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>byId<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_ROOT_ID</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  execNewMounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxViewportTop</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_VIEWPORT_TOP</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxViewportBottom</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_VIEWPORT_BOTTOM</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxViewportTop</span><span class="ahl-punctuation ahl-bracket">}</span>], [<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxViewportBottom</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">hookEl</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeAddPrivateHooks<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxViewportTop</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxViewportBottom</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeAddNewHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>], [data-phx-<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">hookEl</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeAddNewHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_MOUNTED</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeMounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  applyJoinPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>attachTrueDocEl<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">patch</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">DOMPatch</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>markPrunableContentForRemoval<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>performPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">false</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinNewChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>execNewMounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinPending <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>dispatchEvents<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyPendingUpdates<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">live_patch</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">{</span>kind<span class="ahl-punctuation ahl-delimiter">,</span> to<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">live_patch</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>historyPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>hideLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">&gt;</span> 1<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>triggerReconnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>stopCallback<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  triggerBeforeUpdateHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>triggerDOM<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;onBeforeElUpdated&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">isIgnored</span> <span class="ahl-operator">=</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isIgnored<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_UPDATE</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">.</span>isEqualNode<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isIgnored</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">isEqualObj</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">.</span>dataset<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-delimiter">.</span>dataset<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>__beforeUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">hook</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  maybeMounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxMounted</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_MOUNTED</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">hasBeenInvoked</span> <span class="ahl-operator">=</span> <span class="ahl-variable">phxMounted</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>private<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;mounted&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxMounted</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable">hasBeenInvoked</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>execJS<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxMounted</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>putPrivate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;mounted&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  maybeAddNewHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">force</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">newHook</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>addHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">newHook</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">newHook</span><span class="ahl-punctuation ahl-delimiter">.</span>__mounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  performPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">pruneCids</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">isJoinPatch</span> <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">removedEls</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxChildrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">updatedHookIds</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">Set</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>after<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;added&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>triggerDOM<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;onNodeAdded&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">phxViewportTop</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_VIEWPORT_TOP</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">phxViewportBottom</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_VIEWPORT_BOTTOM</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeAddPrivateHooks<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxViewportTop</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxViewportBottom</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeAddNewHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybeMounted<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>after<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;phxChildAdded&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isPhxSticky<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>joinRootViews<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">phxChildrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>before<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;updated&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>triggerBeforeUpdateHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">updatedHookIds</span><span class="ahl-punctuation ahl-delimiter">.</span>add<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fromEl</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>after<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;updated&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">updatedHookIds</span><span class="ahl-punctuation ahl-delimiter">.</span>has<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>__updated<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>after<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;discarded&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>nodeType <span class="ahl-operator">===</span> <span class="ahl-variable">Node</span><span class="ahl-punctuation ahl-delimiter">.</span>ELEMENT_NODE<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">removedEls</span><span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>after<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;transitionsDiscarded&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">els</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>afterElementsRemoved<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">els</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">pruneCids</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">.</span>perform<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isJoinPatch</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>afterElementsRemoved<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">removedEls</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">pruneCids</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">return</span> <span class="ahl-variable">phxChildrenAdded</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  afterElementsRemoved<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">pruneCids</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">destroyedCIDs</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parent</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">components</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_COMPONENT</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">hooks</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">components</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parent</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">cid</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>componentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">destroyedCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>indexOf<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">===</span> <span class="ahl-operator">-</span>1<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">destroyedCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">hooks</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parent</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookEl</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookEl</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">hook</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-comment">&#x2f;&#x2f; We should not pruneCids on joins. Otherwise, in case of</span>
    <span class="ahl-comment">&#x2f;&#x2f; rejoins, we may notify cids that no longer belong to the</span>
    <span class="ahl-comment">&#x2f;&#x2f; current LiveView to be removed.</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">pruneCids</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>maybePushComponentsDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">destroyedCIDs</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  joinNewChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findPhxChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  getChildById<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-punctuation ahl-bracket">}</span>

  getDescendentByEl<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">===</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_PARENT_ID</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  destroyDescendent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">parentId</span> <span class="ahl-keyword">in</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">childId</span> <span class="ahl-keyword">in</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">parentId</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">childId</span> <span class="ahl-operator">===</span> <span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">parentId</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">childId</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>destroy<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  joinChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">child</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getChildById<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">child</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">view</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">View</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">view</span>
      <span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>join<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>childJoins<span class="ahl-operator">++</span>
      <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  isJoinPending<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinPending <span class="ahl-punctuation ahl-bracket">}</span>

  ackJoin<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">_child</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>childJoins<span class="ahl-operator">--</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>childJoins <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>parent<span class="ahl-punctuation ahl-delimiter">.</span>ackJoin<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onAllChildJoinsComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onAllChildJoinsComplete<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCallback<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps<span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">op</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">op</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  update<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isJoinPending<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>hasPendingLink<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingDiffs<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>mergeDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxChildrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>

    <span class="ahl-comment">&#x2f;&#x2f; When the diff only contains component diffs, then walk components</span>
    <span class="ahl-comment">&#x2f;&#x2f; and patch only the parent component containers found in the diff.</span>
    <span class="ahl-comment">&#x2f;&#x2f; Otherwise, patch entire LV container.</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>isComponentOnlyDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>time<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;component patch complete&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">parentCids</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findExistingParentCIDs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>componentCIDs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">parentCids</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parentCID</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>componentPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>getComponent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">parentCID</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">parentCID</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">phxChildrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span> <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">isEmpty</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>time<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;full patch complete&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>renderContainer<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;update&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">patch</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">DOMPatch</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">phxChildrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>performPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>dispatchEvents<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxChildrenAdded</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinNewChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  renderContainer<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>time<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`toString diff (<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">}</span>)`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">tag</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>tagName
      <span class="ahl-comment">&#x2f;&#x2f; Don&#x27;t skip any component in the diff nor any marked as pruned</span>
      <span class="ahl-comment">&#x2f;&#x2f; (as they may have been added back)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">cids</span> <span class="ahl-operator">=</span> <span class="ahl-variable">diff</span> ? <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>componentCIDs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span> : <span class="ahl-constant ahl-builtin">null</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>toString<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cids</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">`&lt;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">tag</span><span class="ahl-punctuation ahl-bracket">}</span>&gt;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-bracket">}</span>&lt;&#x2f;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">tag</span><span class="ahl-punctuation ahl-bracket">}</span>&gt;`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  componentPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isEmpty</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>componentToString<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">patch</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">DOMPatch</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">html</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">streams</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">childrenAdded</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>performPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">patch</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">childrenAdded</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  getHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ViewHook</span><span class="ahl-punctuation ahl-delimiter">.</span>elementID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-punctuation ahl-bracket">}</span>

  addHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ViewHook</span><span class="ahl-punctuation ahl-delimiter">.</span>elementID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-operator">!</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">hookName</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`data-phx-<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-bracket">}</span>`</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_HOOK</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookName</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>ownsElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">callbacks</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>getHookCallbacks<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookName</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">callbacks</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`no DOM ID for hook &quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">hookName</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;. Hooks require a unique ID on each element.`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">ViewHook</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callbacks</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ViewHook</span><span class="ahl-punctuation ahl-delimiter">.</span>elementID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">hook</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">hook</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookName</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`unknown hook found for &quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">hookName</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  destroyHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>__destroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>__cleanup__<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">delete</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>viewHooks<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ViewHook</span><span class="ahl-punctuation ahl-delimiter">.</span>elementID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  applyPendingUpdates<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingDiffs<span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>update<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pendingDiffs <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>eachChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">child</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">child</span><span class="ahl-punctuation ahl-delimiter">.</span>applyPendingUpdates<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  eachChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">children</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>children<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">||</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">id</span> <span class="ahl-keyword">in</span> <span class="ahl-variable">children</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getChildById<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">id</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cb</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isJoinPending<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>root<span class="ahl-punctuation ahl-delimiter">.</span>pendingJoinOps<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">cb</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>requestDOMUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">cb</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  bindChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-comment">&#x2f;&#x2f; The diff event should be handled by the regular update operations.</span>
    <span class="ahl-comment">&#x2f;&#x2f; All other operations are queued to be applied only after join.</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;diff&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">rawDiff</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>requestDOMUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;update&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">rawDiff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>update<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;redirect&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to<span class="ahl-punctuation ahl-delimiter">,</span> flash<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to<span class="ahl-punctuation ahl-delimiter">,</span> flash<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;live_patch&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onLivePatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;live_redirect&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onLiveRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>onError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>onClose<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onClose<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  destroyAllChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>eachChild<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">child</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">child</span><span class="ahl-punctuation ahl-delimiter">.</span>destroy<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  onLiveRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">{</span>to<span class="ahl-punctuation ahl-delimiter">,</span> kind<span class="ahl-punctuation ahl-delimiter">,</span> flash<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">redir</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">url</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>expandURL<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>historyRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">url</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">flash</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onLivePatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">redir</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">{</span>to<span class="ahl-punctuation ahl-delimiter">,</span> kind<span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-operator">=</span> <span class="ahl-variable">redir</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>expandURL<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>historyPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  expandURL<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">to</span><span class="ahl-punctuation ahl-delimiter">.</span>startsWith<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;&#x2f;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span> ? <span class="ahl-string">`<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">.</span>location<span class="ahl-punctuation ahl-delimiter">.</span>protocol<span class="ahl-punctuation ahl-bracket">}</span>&#x2f;&#x2f;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">.</span>location<span class="ahl-punctuation ahl-delimiter">.</span>host<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-bracket">}</span>`</span> : <span class="ahl-variable">to</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to<span class="ahl-punctuation ahl-delimiter">,</span> flash<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">to</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">flash</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>

  isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyed <span class="ahl-punctuation ahl-bracket">}</span>

  joinDead<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDead <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span> <span class="ahl-punctuation ahl-bracket">}</span>

  join<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>showLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>loaderTimeout<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>bindChannel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>stopCallback <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>withPageLoading<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-delimiter">,</span> kind: <span class="ahl-string">&quot;initial&quot;</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCallback <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">onDone</span> <span class="ahl-operator">=</span> <span class="ahl-variable">onDone</span> <span class="ahl-operator">||</span> <span class="ahl-keyword">function</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-variable">callback</span> ? <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">)</span> : <span class="ahl-variable">onDone</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>wrapPush<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>timeout: <span class="ahl-constant ahl-builtin">false</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>join<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;ok&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">data</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>requestDOMUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onJoin<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">data</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onJoinError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;timeout&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onJoinError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>reason: <span class="ahl-string">&quot;timeout&quot;</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onJoinError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>reason <span class="ahl-operator">===</span> <span class="ahl-string">&quot;reload&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">`failed mount with <span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>status<span class="ahl-punctuation ahl-bracket">}</span>. Falling back to page request`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">return</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>reason <span class="ahl-operator">===</span> <span class="ahl-string">&quot;unauthorized&quot;</span> <span class="ahl-operator">||</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>reason <span class="ahl-operator">===</span> <span class="ahl-string">&quot;stale&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;unauthorized live_redirect. Falling back to page request&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>to: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">return</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect <span class="ahl-operator">||</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinPending <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">false</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>leave<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onLiveRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_redirect<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>displayError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_SERVER_ERROR_CLASS</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;unable to join&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>reloadWithJitter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onClose<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>hasPendingLink<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">reason</span> <span class="ahl-operator">!==</span> <span class="ahl-string">&quot;leave&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>reloadWithJitter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>destroyAllChildren<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>dropActiveElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-comment">&#x2f;&#x2f; document.activeElement can be null in Internet Explorer 11</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">.</span>activeElement<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">.</span>activeElement<span class="ahl-punctuation ahl-delimiter">.</span>blur<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>isUnloaded<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>showLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">BEFORE_UNLOAD_LOADER_TIMEOUT</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  onError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onClose<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;view crashed&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>isUnloaded<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>displayError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_SERVER_ERROR_CLASS</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>displayError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">PHX_LOADING_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_ERROR_CLASS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_CLIENT_ERROR_CLASS</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  displayError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">classes</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>dispatchEvent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;phx:page-loading-start&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>detail: <span class="ahl-punctuation ahl-bracket">{</span>to: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-delimiter">,</span> kind: <span class="ahl-string">&quot;error&quot;</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>showLoader<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>setContainerClasses<span class="ahl-punctuation ahl-bracket">(</span>...<span class="ahl-variable">classes</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>execAll<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;disconnected&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">refGenerator</span> ? <span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> : <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">]</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">onLoadingDone</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>page_loading <span class="ahl-operator">||</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_PAGE_LOADING</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">onLoadingDone</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>withPageLoading<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>kind: <span class="ahl-string">&quot;element&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> target: <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">typeof</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">.</span>cid<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">!==</span> <span class="ahl-string">&quot;number&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">delete</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">.</span>cid <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">(</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>wrapPush<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>timeout: <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PUSH_TIMEOUT</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;ok&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">let</span> <span class="ahl-variable">finish</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hookReply</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
            <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_patch<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onLivePatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_patch<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
            <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>onLiveRedirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>live_redirect<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
            <span class="ahl-variable">onLoadingDone</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">hookReply</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>diff<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>requestDOMUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
              <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyDiff<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;update&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">{</span>diff<span class="ahl-punctuation ahl-delimiter">,</span> reply<span class="ahl-punctuation ahl-delimiter">,</span> events<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
                <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
                <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>update<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">diff</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">events</span><span class="ahl-punctuation ahl-bracket">)</span>
                <span class="ahl-variable">finish</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reply</span><span class="ahl-punctuation ahl-bracket">)</span>
              <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
            <span class="ahl-variable">finish</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-comment">&#x2f;&#x2f; exit if external form triggered</span>

    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-bracket">}</span>=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">}</span>&quot;][<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">}</span>=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;]`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">disabledVal</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">readOnlyVal</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_READONLY</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-comment">&#x2f;&#x2f; remove refs</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-comment">&#x2f;&#x2f; restore inputs</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">readOnlyVal</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>readOnly <span class="ahl-operator">=</span> <span class="ahl-variable">readOnlyVal</span> <span class="ahl-operator">===</span> <span class="ahl-string">&quot;true&quot;</span> ? <span class="ahl-constant ahl-builtin">true</span> : <span class="ahl-constant ahl-builtin">false</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_READONLY</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disabledVal</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled <span class="ahl-operator">=</span> <span class="ahl-variable">disabledVal</span> <span class="ahl-operator">===</span> <span class="ahl-string">&quot;true&quot;</span> ? <span class="ahl-constant ahl-builtin">true</span> : <span class="ahl-constant ahl-builtin">false</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-comment">&#x2f;&#x2f; remove classes</span>
      <span class="ahl-variable">PHX_EVENT_CLASSES</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">className</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>removeClass<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">className</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-comment">&#x2f;&#x2f; restore disables</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">disableRestore</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH_RESTORE</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disableRestore</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>innerText <span class="ahl-operator">=</span> <span class="ahl-variable">disableRestore</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>removeAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH_RESTORE</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">toEl</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>private<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">hook</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>triggerBeforeUpdateHook<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">DOMPatch</span><span class="ahl-punctuation ahl-delimiter">.</span>patchEl<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">toEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>getActiveElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">hook</span><span class="ahl-punctuation ahl-delimiter">.</span>__updated<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>deletePrivate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">newRef</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>ref<span class="ahl-operator">++</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">disableWith</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>loading<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">elements</span> <span class="ahl-operator">=</span> <span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>loading<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">el</span> <span class="ahl-keyword">of</span> <span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newRef</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF_SRC</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>submitter <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">===</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>submitter <span class="ahl-operator">||</span> <span class="ahl-variable">el</span> <span class="ahl-operator">===</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">continue</span> <span class="ahl-punctuation ahl-bracket">}</span>

      <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>classList<span class="ahl-punctuation ahl-delimiter">.</span>add<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`phx-<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">event</span><span class="ahl-punctuation ahl-bracket">}</span>-loading`</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">disableText</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disableWith</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disableText</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH_RESTORE</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH_RESTORE</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>innerText<span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disableText</span> <span class="ahl-operator">!==</span> <span class="ahl-string">&quot;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>innerText <span class="ahl-operator">=</span> <span class="ahl-variable">disableText</span> <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-comment">&#x2f;&#x2f; PHX_DISABLED could have already been set in disableForm</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled<span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;disabled&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">newRef</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">elements</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">]</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  componentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">cid</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_COMPONENT</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">cid</span> ? <span class="ahl-variable">parseInt</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span> : <span class="ahl-constant ahl-builtin">null</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">target</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable">targetCtx</span> <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">cidOrSelector</span> <span class="ahl-operator">=</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>target <span class="ahl-operator">||</span> <span class="ahl-variable">target</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;target&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cidOrSelector</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">parseInt</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cidOrSelector</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cidOrSelector</span> <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">null</span> <span class="ahl-operator">||</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>target<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>closestComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  closestComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">targetCtx</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">maybe</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">.</span>closest<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">PHX_COMPONENT</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>ownsElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>componentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushHookEvent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isConnected<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;hook&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;unable to push hook event. LiveView not connected&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">false</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">els</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;hook&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">els</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;event&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>
      type: <span class="ahl-string">&quot;hook&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span>
      event: <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span>
      value: <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">,</span>
      cid: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>closestComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reply</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reply</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">return</span> <span class="ahl-variable">ref</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  extractMeta<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">value</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">prefix</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;value-&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">i</span> <span class="ahl-operator">=</span> 0<span class="ahl-punctuation ahl-delimiter">;</span> <span class="ahl-variable">i</span> <span class="ahl-operator">&lt;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>attributes<span class="ahl-punctuation ahl-delimiter">.</span>length<span class="ahl-punctuation ahl-delimiter">;</span> <span class="ahl-variable">i</span><span class="ahl-operator">++</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">name</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>attributes<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">i</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>name
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">name</span><span class="ahl-punctuation ahl-delimiter">.</span>startsWith<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">prefix</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">name</span><span class="ahl-punctuation ahl-delimiter">.</span>replace<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">prefix</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">name</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>value <span class="ahl-operator">!==</span> <span class="ahl-constant ahl-builtin">undefined</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-keyword">instanceof</span> <span class="ahl-variable">HTMLFormElement</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">.</span>value <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>value

      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>tagName <span class="ahl-operator">===</span> <span class="ahl-string">&quot;INPUT&quot;</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">CHECKABLE_INPUTS</span><span class="ahl-punctuation ahl-delimiter">.</span>indexOf<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>type<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&gt;=</span> 0 <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>checked<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">delete</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">.</span>value
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">value</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-keyword">for</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-keyword">let</span> <span class="ahl-variable">key</span> <span class="ahl-keyword">in</span> <span class="ahl-variable">value</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">value</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">key</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">meta</span>
  <span class="ahl-punctuation ahl-bracket">}</span>


  pushEvent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">type</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">type</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;event&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>
      type: <span class="ahl-variable">type</span><span class="ahl-punctuation ahl-delimiter">,</span>
      event: <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span>
      value: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>extractMeta<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>value<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
      cid: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reply</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">onReply</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">reply</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushFileProgress<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fileEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">entryRef</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">progress</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">function</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>withinOwners<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fileEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;progress&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>
        event: <span class="ahl-variable">fileEl</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_PROGRESS</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        ref: <span class="ahl-variable">fileEl</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_UPLOAD_REF</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        entry_ref: <span class="ahl-variable">entryRef</span><span class="ahl-punctuation ahl-delimiter">,</span>
        progress: <span class="ahl-variable">progress</span><span class="ahl-punctuation ahl-delimiter">,</span>
        cid: <span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">fileEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushInput<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">forceCid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">uploads</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">cid</span> <span class="ahl-operator">=</span> <span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">forceCid</span><span class="ahl-punctuation ahl-bracket">)</span> ? <span class="ahl-variable">forceCid</span> : <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">refGenerator</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">formData</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">meta</span>  <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>extractMeta<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span> <span class="ahl-keyword">instanceof</span> <span class="ahl-variable">HTMLButtonElement</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-delimiter">.</span>submitter <span class="ahl-operator">=</span> <span class="ahl-variable">inputEl</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">formData</span> <span class="ahl-operator">=</span> <span class="ahl-variable">serializeForm</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>_target: <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>_target<span class="ahl-punctuation ahl-delimiter">,</span> ...<span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>name<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">formData</span> <span class="ahl-operator">=</span> <span class="ahl-variable">serializeForm</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>_target: <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">.</span>_target<span class="ahl-punctuation ahl-delimiter">,</span> ...<span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isUploadInput<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>files <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>files<span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>trackFiles<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">Array</span><span class="ahl-punctuation ahl-delimiter">.</span>from<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>files<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable">uploads</span> <span class="ahl-operator">=</span> <span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>serializeUploads<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">event</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span>
      type: <span class="ahl-string">&quot;form&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span>
      event: <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span>
      value: <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">,</span>
      uploads: <span class="ahl-variable">uploads</span><span class="ahl-punctuation ahl-delimiter">,</span>
      cid: <span class="ahl-variable">cid</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;event&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">event</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>showError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_FEEDBACK_FOR</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_FEEDBACK_GROUP</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isUploadInput<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isAutoUpload<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>filesAwaitingPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_els</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>uploadFiles<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">_uploads</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable">callback</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>triggerAwaitingSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">)</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">callback</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  triggerAwaitingSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">awaitingSubmit</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getScheduledSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">awaitingSubmit</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">_el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">awaitingSubmit</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>cancelSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  getScheduledSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formSubmits<span class="ahl-punctuation ahl-delimiter">.</span>find<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_callback</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>isSameNode<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  scheduleSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>getScheduledSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">true</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formSubmits<span class="ahl-punctuation ahl-delimiter">.</span>push<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  cancelSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formSubmits <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>formSubmits<span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_callback</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>isSameNode<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">false</span>
      <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">true</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  disableForm<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">filterIgnored</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">userIgnored</span> <span class="ahl-operator">=</span> <span class="ahl-variable">closestPhxBinding</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_UPDATE</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">}</span>=ignore`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-operator">!</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">userIgnored</span> <span class="ahl-operator">||</span> <span class="ahl-variable">closestPhxBinding</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;data-phx-update=ignore&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">filterDisables</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>hasAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLE_WITH</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">filterButton</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>tagName <span class="ahl-operator">==</span> <span class="ahl-string">&quot;BUTTON&quot;</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">filterInput</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;INPUT&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;TEXTAREA&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;SELECT&quot;</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>includes<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>tagName<span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">formElements</span> <span class="ahl-operator">=</span> <span class="ahl-variable">Array</span><span class="ahl-punctuation ahl-delimiter">.</span>from<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">.</span>elements<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">disables</span> <span class="ahl-operator">=</span> <span class="ahl-variable">formElements</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">filterDisables</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">buttons</span> <span class="ahl-operator">=</span> <span class="ahl-variable">formElements</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">filterButton</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">filterIgnored</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">inputs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">formElements</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">filterInput</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">filterIgnored</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-variable">buttons</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">button</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">button</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">button</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">button</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_READONLY</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>readOnly<span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>readOnly <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>files<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_DISABLED</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled<span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>disabled <span class="ahl-operator">=</span> <span class="ahl-constant ahl-builtin">true</span>
      <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">.</span>setAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_PAGE_LOADING</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">disables</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">buttons</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>concat<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;submit&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushFormSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">refGenerator</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>disableForm<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>...<span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> form: <span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> submitter: <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">cid</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>hasUploadsInProgress<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">_els</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">push</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushFormSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>scheduleSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">push</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>inputsAwaitingPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">els</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">proxyRefGen</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">els</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-bracket">]</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>uploadFiles<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">uploads</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-comment">&#x2f;&#x2f; if we still having pending preflights it means we have invalid entries</span>
        <span class="ahl-comment">&#x2f;&#x2f; and the phx-submit cannot be completed</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>inputsAwaitingPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">meta</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>extractMeta<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">formData</span> <span class="ahl-operator">=</span> <span class="ahl-variable">serializeForm</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>submitter<span class="ahl-punctuation ahl-delimiter">,</span> ...<span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">proxyRefGen</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;event&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>
          type: <span class="ahl-string">&quot;form&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span>
          event: <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span>
          value: <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">,</span>
          cid: <span class="ahl-variable">cid</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">.</span>hasAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_REF</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">.</span>classList<span class="ahl-punctuation ahl-delimiter">.</span>contains<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;phx-submit-loading&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">meta</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>extractMeta<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">formData</span> <span class="ahl-operator">=</span> <span class="ahl-variable">serializeForm</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>submitter<span class="ahl-punctuation ahl-delimiter">,</span> ...<span class="ahl-variable">meta</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">refGenerator</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;event&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>
        type: <span class="ahl-string">&quot;form&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span>
        event: <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span>
        value: <span class="ahl-variable">formData</span><span class="ahl-punctuation ahl-delimiter">,</span>
        cid: <span class="ahl-variable">cid</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onReply</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  uploadFiles<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onComplete</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">joinCountAtUpload</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount
    <span class="ahl-keyword">let</span> <span class="ahl-variable">inputEls</span> <span class="ahl-operator">=</span> <span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>activeFileInputs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">formEl</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">numFileInputsInProgress</span> <span class="ahl-operator">=</span> <span class="ahl-variable">inputEls</span><span class="ahl-punctuation ahl-delimiter">.</span>length

    <span class="ahl-comment">&#x2f;&#x2f; get each file input</span>
    <span class="ahl-variable">inputEls</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">uploader</span> <span class="ahl-operator">=</span> <span class="ahl-keyword">new</span> <span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">numFileInputsInProgress</span><span class="ahl-operator">--</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">numFileInputsInProgress</span> <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">onComplete</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">;</span>

      <span class="ahl-keyword">let</span> <span class="ahl-variable">entries</span> <span class="ahl-operator">=</span> <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>map<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>toPreflightPayload<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>

      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entries</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable">numFileInputsInProgress</span><span class="ahl-operator">--</span>
        <span class="ahl-keyword">return</span>
      <span class="ahl-punctuation ahl-bracket">}</span>

      <span class="ahl-keyword">let</span> <span class="ahl-variable">payload</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span>
        ref: <span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_UPLOAD_REF</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">,</span>
        entries: <span class="ahl-variable">entries</span><span class="ahl-punctuation ahl-delimiter">,</span>
        cid: <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputEl</span><span class="ahl-punctuation ahl-delimiter">.</span>form<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-punctuation ahl-bracket">}</span>

      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;upload&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;sending preflight request&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>

      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;allow_upload&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">payload</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;upload&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;got preflight response&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-comment">&#x2f;&#x2f; the preflight will reject entries beyond the max entries</span>
        <span class="ahl-comment">&#x2f;&#x2f; so we error and cancel entries on the client that are missing from the response</span>
        <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>entries <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>ref<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>handleFailedEntryPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>ref<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;failed preflight&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-comment">&#x2f;&#x2f; for auto uploads, we may have an empty entries response from the server</span>
        <span class="ahl-comment">&#x2f;&#x2f; for form submits that contain invalid entries</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>error <span class="ahl-operator">||</span> <span class="ahl-variable">Object</span><span class="ahl-punctuation ahl-delimiter">.</span>keys<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>undoRefs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">ref</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-keyword">let</span> <span class="ahl-variable">errors</span> <span class="ahl-operator">=</span> <span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>error <span class="ahl-operator">||</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span>
          <span class="ahl-variable">errors</span><span class="ahl-punctuation ahl-delimiter">.</span>map<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">entry_ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>handleFailedEntryPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry_ref</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">let</span> <span class="ahl-variable">onError</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>channel<span class="ahl-punctuation ahl-delimiter">.</span>onError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
              <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">===</span> <span class="ahl-variable">joinCountAtUpload</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
            <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
          <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>initAdapterUpload<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">onError</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  handleFailedEntryPreflight<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">uploadRef</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>isAutoUpload<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-comment">&#x2f;&#x2f; uploadRef may be top level upload config ref or entry ref</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">entry</span> <span class="ahl-operator">=</span> <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>find<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>ref <span class="ahl-operator">===</span> <span class="ahl-variable">uploadRef</span><span class="ahl-punctuation ahl-delimiter">.</span>toString<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>cancel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">uploader</span><span class="ahl-punctuation ahl-delimiter">.</span>entries<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>map<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">entry</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">entry</span><span class="ahl-punctuation ahl-delimiter">.</span>cancel<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>log<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;upload&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">`error for entry <span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">uploadRef</span><span class="ahl-punctuation ahl-bracket">}</span>`</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">reason</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  dispatchUploads<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">name</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">filesOrBlobs</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">targetElement</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetCtxElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el
    <span class="ahl-keyword">let</span> <span class="ahl-variable">inputs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findUploadInputs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetElement</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>name <span class="ahl-operator">===</span> <span class="ahl-variable">name</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`no live file inputs found matching the name &quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">name</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;`</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 1<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">logError</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`duplicate live file inputs found matching the name &quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">name</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;`</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
    <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>dispatchEvent<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-bracket">[</span>0<span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_TRACK_UPLOADS</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>detail: <span class="ahl-punctuation ahl-bracket">{</span>files: <span class="ahl-variable">filesOrBlobs</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  targetCtxElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">isCid</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">target</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-operator">=</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findComponentNodeList<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">target</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">targetCtx</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushFormRecovery<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>withinOwners<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">phxChange</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">inputs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">Array</span><span class="ahl-punctuation ahl-delimiter">.</span>from<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>elements<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>isFormInput<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>name <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-operator">!</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>hasAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxChange</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">}</span>

      <span class="ahl-comment">&#x2f;&#x2f; we must clear tracked uploads before recovery as they no longer have valid refs</span>
      <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>hasAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_UPLOAD_REF</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">LiveUploader</span><span class="ahl-punctuation ahl-delimiter">.</span>clearFiles<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-keyword">let</span> <span class="ahl-variable">input</span> <span class="ahl-operator">=</span> <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>find<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>type <span class="ahl-operator">!==</span> <span class="ahl-string">&quot;hidden&quot;</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-bracket">[</span>0<span class="ahl-punctuation ahl-bracket">]</span>

      <span class="ahl-keyword">let</span> <span class="ahl-variable">phxEvent</span> <span class="ahl-operator">=</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_AUTO_RECOVER</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable">JS</span><span class="ahl-punctuation ahl-delimiter">.</span>exec<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">view</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-string">&quot;push&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>_target: <span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">.</span>name<span class="ahl-punctuation ahl-delimiter">,</span> newCid: <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-delimiter">,</span> callback: <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  pushLinkPatch<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetEl</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">linkRef</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>setPendingLink<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">refGen</span> <span class="ahl-operator">=</span> <span class="ahl-variable">targetEl</span> ? <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>putRef<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">targetEl</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;click&quot;</span><span class="ahl-punctuation ahl-bracket">)</span> : <span class="ahl-constant ahl-builtin">null</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">fallback</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>redirect<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">window</span><span class="ahl-punctuation ahl-delimiter">.</span>location<span class="ahl-punctuation ahl-delimiter">.</span>href<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">url</span> <span class="ahl-operator">=</span> <span class="ahl-variable">href</span><span class="ahl-punctuation ahl-delimiter">.</span>startsWith<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;&#x2f;&quot;</span><span class="ahl-punctuation ahl-bracket">)</span> ? <span class="ahl-string">`<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">location</span><span class="ahl-punctuation ahl-delimiter">.</span>protocol<span class="ahl-punctuation ahl-bracket">}</span>&#x2f;&#x2f;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">location</span><span class="ahl-punctuation ahl-delimiter">.</span>host<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-bracket">}</span>`</span> : <span class="ahl-variable">href</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">push</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">refGen</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;live_patch&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>url<span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">resp</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>requestDOMUpdate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>link_redirect<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>replaceMain<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">href</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">linkRef</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>commitPendingLink<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">linkRef</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>href <span class="ahl-operator">=</span> <span class="ahl-variable">href</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>applyPendingUpdates<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-variable">callback</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">callback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">linkRef</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">push</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">push</span><span class="ahl-punctuation ahl-delimiter">.</span>receive<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;timeout&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">fallback</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">fallback</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  formsForRecovery<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">html</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>joinCount <span class="ahl-operator">===</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-punctuation ahl-bracket">]</span> <span class="ahl-punctuation ahl-bracket">}</span>

    <span class="ahl-keyword">let</span> <span class="ahl-variable">phxChange</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;change&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">template</span> <span class="ahl-operator">=</span> <span class="ahl-variable">document</span><span class="ahl-punctuation ahl-delimiter">.</span>createElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">&quot;template&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">template</span><span class="ahl-punctuation ahl-delimiter">.</span>innerHTML <span class="ahl-operator">=</span> <span class="ahl-variable">html</span>

    <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">(</span>
      <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>all<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">`form[<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxChange</span><span class="ahl-punctuation ahl-bracket">}</span>]`</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>ownsElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>elements<span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_AUTO_RECOVER</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">!==</span> <span class="ahl-string">&quot;ignore&quot;</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>map<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-comment">&#x2f;&#x2f; attribute given via JS module needs to be escaped as it contains the symbols []&quot;,</span>
          <span class="ahl-comment">&#x2f;&#x2f; which result in an invalid css selector otherwise.</span>
          <span class="ahl-keyword">const</span> <span class="ahl-variable">phxChangeValue</span> <span class="ahl-operator">=</span> <span class="ahl-variable">CSS</span><span class="ahl-punctuation ahl-delimiter">.</span>escape<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">phxChange</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-keyword">let</span> <span class="ahl-variable">newForm</span> <span class="ahl-operator">=</span> <span class="ahl-variable">template</span><span class="ahl-punctuation ahl-delimiter">.</span>content<span class="ahl-punctuation ahl-delimiter">.</span>querySelector<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-string">`form[id=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">}</span>&quot;][<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxChange</span><span class="ahl-punctuation ahl-bracket">}</span>=&quot;<span class="ahl-punctuation ahl-special">${</span><span class="ahl-variable">phxChangeValue</span><span class="ahl-punctuation ahl-bracket">}</span>&quot;]`</span><span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span>
          <span class="ahl-punctuation ahl-bracket">}</span> <span class="ahl-keyword">else</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-keyword">return</span> <span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>targetComponentID<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">]</span>
          <span class="ahl-punctuation ahl-bracket">}</span>
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">[</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">newCid</span><span class="ahl-punctuation ahl-bracket">]</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">newForm</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  maybePushComponentsDestroyed<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">destroyedCIDs</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">willDestroyCIDs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">destroyedCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-keyword">return</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findComponentNodeList<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

    <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">willDestroyCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-comment">&#x2f;&#x2f; we must reset the render change tracking for cids that</span>
      <span class="ahl-comment">&#x2f;&#x2f; could be added back from the server so we don&#x27;t skip them</span>
      <span class="ahl-variable">willDestroyCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>resetRender<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>

      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;cids_will_destroy&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>cids: <span class="ahl-variable">willDestroyCIDs</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
        <span class="ahl-comment">&#x2f;&#x2f; See if any of the cids we wanted to destroy were added back,</span>
        <span class="ahl-comment">&#x2f;&#x2f; if they were added back, we don&#x27;t actually destroy them.</span>
        <span class="ahl-keyword">let</span> <span class="ahl-variable">completelyDestroyCIDs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">willDestroyCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>filter<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">cid</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-keyword">return</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>findComponentNodeList<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>el<span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">cid</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">===</span> 0
        <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>

        <span class="ahl-keyword">if</span><span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">completelyDestroyCIDs</span><span class="ahl-punctuation ahl-delimiter">.</span>length <span class="ahl-operator">&gt;</span> 0<span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
          <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushWithReply<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-constant ahl-builtin">null</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-string">&quot;cids_destroyed&quot;</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">{</span>cids: <span class="ahl-variable">completelyDestroyCIDs</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
            <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>rendered<span class="ahl-punctuation ahl-delimiter">.</span>pruneCIDs<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">resp</span><span class="ahl-punctuation ahl-delimiter">.</span>cids<span class="ahl-punctuation ahl-bracket">)</span>
          <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
        <span class="ahl-punctuation ahl-bracket">}</span>
      <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  ownsElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">el</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-keyword">let</span> <span class="ahl-variable">parentViewEl</span> <span class="ahl-operator">=</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>closest<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_VIEW_SELECTOR</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">return</span> <span class="ahl-variable">el</span><span class="ahl-punctuation ahl-delimiter">.</span>getAttribute<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_PARENT_ID</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">===</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">||</span>
      <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">parentViewEl</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable">parentViewEl</span><span class="ahl-punctuation ahl-delimiter">.</span>id <span class="ahl-operator">===</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>id<span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">||</span>
      <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-operator">!</span><span class="ahl-variable">parentViewEl</span> <span class="ahl-operator">&amp;&amp;</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>isDead<span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  submitForm<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span> <span class="ahl-operator">=</span> <span class="ahl-punctuation ahl-bracket">{</span><span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span>
    <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>putPrivate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_HAS_SUBMITTED</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">const</span> <span class="ahl-variable">phxFeedbackFor</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_FEEDBACK_FOR</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">const</span> <span class="ahl-variable">phxFeedbackGroup</span> <span class="ahl-operator">=</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">PHX_FEEDBACK_GROUP</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-keyword">const</span> <span class="ahl-variable">inputs</span> <span class="ahl-operator">=</span> <span class="ahl-variable">Array</span><span class="ahl-punctuation ahl-delimiter">.</span>from<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">.</span>elements<span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>putPrivate<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">PHX_HAS_SUBMITTED</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-constant ahl-builtin">true</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>blurActiveElement<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>pushFormSubmit<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">form</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">targetCtx</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxEvent</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">submitter</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">opts</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-punctuation ahl-bracket">{</span>
      <span class="ahl-variable">inputs</span><span class="ahl-punctuation ahl-delimiter">.</span>forEach<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span> <span class="ahl-operator">=&gt;</span> <span class="ahl-variable">DOM</span><span class="ahl-punctuation ahl-delimiter">.</span>showError<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">input</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxFeedbackFor</span><span class="ahl-punctuation ahl-delimiter">,</span> <span class="ahl-variable">phxFeedbackGroup</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">)</span>
      <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>restorePreviouslyActiveFocus<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-punctuation ahl-bracket">)</span>
    <span class="ahl-punctuation ahl-bracket">}</span><span class="ahl-punctuation ahl-bracket">)</span>
  <span class="ahl-punctuation ahl-bracket">}</span>

  binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">)</span><span class="ahl-punctuation ahl-bracket">{</span> <span class="ahl-keyword">return</span> <span class="ahl-variable ahl-builtin">this</span><span class="ahl-punctuation ahl-delimiter">.</span>liveSocket<span class="ahl-punctuation ahl-delimiter">.</span>binding<span class="ahl-punctuation ahl-bracket">(</span><span class="ahl-variable">kind</span><span class="ahl-punctuation ahl-bracket">)</span> <span class="ahl-punctuation ahl-bracket">}</span>
<span class="ahl-punctuation ahl-bracket">}</span>
</code></pre>
</body>
</html>
