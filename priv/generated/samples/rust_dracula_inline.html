<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Autumn Sample - rust - dracula (inline)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'JetBrains Mono', monospace;
      line-height: 1.5;
    }
    pre {
      font-size: 15px;
      margin: 20px;
      padding: 50px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <pre class="autumn-hl" style="background-color: #282A36; color: #f8f8f2;"><code class="language-rust" translate="no">#![doc = include_str!(&quot;..&#x2f;README.md&quot;)]

<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">mod</span> <span class="ahl-namespace" style="color: #f8f8f2;">c_lib</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">c_lib</span> <span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">as</span> <span class="ahl-namespace" style="color: #f8f8f2;">c</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">lazy_static</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">lazy_static</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">std</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">collections</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HashSet</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">std</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">sync</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">atomic</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">AtomicUsize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Ordering</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">std</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span><span class="ahl-namespace" style="color: #f8f8f2;">iter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">mem</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">ops</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">thiserror</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-control ahl-import" style="color: #ff79c6;">use</span> <span class="ahl-namespace" style="color: #f8f8f2;">tree_sitter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">LossyUtf8</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCaptures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCursor</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryError</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryMatch</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Tree</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

<span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">const</span> <span class="ahl-constant" style="color: #BD93F9;">CANCELLATION_CHECK_INTERVAL</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">100</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">const</span> <span class="ahl-constant" style="color: #BD93F9;">BUFFER_HTML_RESERVE_CAPACITY</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">10</span> <span class="ahl-operator" style="color: #f8f8f2;">*</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1024</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">const</span> <span class="ahl-constant" style="color: #BD93F9;">BUFFER_LINES_RESERVE_CAPACITY</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1000</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

<span class="ahl-function ahl-macro" style="color: #BD93F9;">lazy_static</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">static</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">ref</span> <span class="ahl-constant" style="color: #BD93F9;">STANDARD_CAPTURE_NAMES</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HashSet</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">static</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-function ahl-macro" style="color: #BD93F9;">vec</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;attribute&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;boolean&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;carriage-return&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;comment&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;comment.documentation&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;constant&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;constant.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;constructor&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;constructor.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;embedded&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;error&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;escape&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;function&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;function.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;keyword&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.bold&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.heading&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.italic&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.link&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.link.url&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.list&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.list.checked&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.list.numbered&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.list.unchecked&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.list.unnumbered&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.quote&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.raw&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.raw.block&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.raw.inline&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;markup.strikethrough&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;module&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;number&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;operator&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;property&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;property.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;punctuation&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;punctuation.bracket&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;punctuation.delimiter&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;punctuation.special&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;string&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;string.escape&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;string.regexp&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;string.special&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;string.special.symbol&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;tag&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;type&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;type.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;variable&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;variable.builtin&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;variable.member&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-string" style="color: #f1fa8c;">&quot;variable.parameter&quot;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span>
    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">into_iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">collect</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Indicates which highlight should be applied to a region of source code.</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-special" style="color: #ff79c6;">derive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Copy</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Clone</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Debug</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">PartialEq</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Eq</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Represents the reason why syntax highlighting failed.</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-special" style="color: #ff79c6;">derive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Debug</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">PartialEq</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Eq</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">enum</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">&quot;Cancelled&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">Cancelled</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">&quot;Invalid language&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">InvalidLanguage</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">&quot;Unknown error&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">Unknown</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Represents a single step in rendering a syntax-highlighted document.</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-special" style="color: #ff79c6;">derive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Copy</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Clone</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Debug</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">enum</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">Source</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">HighlightStart</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-type ahl-enum variant" style="font-style: italic; color: #f8f8f2;">HighlightEnd</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Contains the data needed to highlight code written in a particular language.</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; This struct is immutable and can be shared between threads.</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">String</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">combined_injections_query</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">locals_pattern_index</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlights_pattern_index</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_indices</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">non_local_variable_patterns</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">bool</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_content_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_language_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_scope_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_value_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_ref_capture_index</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Performs syntax highlighting, recognizing a given list of highlight names.</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; For the best performance `Highlighter` values should be reused between</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; syntax highlighting calls. A separate highlighter is needed for each thread that</span>
<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; is performing highlighting.</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlighter</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursors</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCursor</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Converts a general-purpose syntax highlighting iterator into a sequence of lines of HTML.</span>
<span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HtmlRenderer</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">carriage_return_highlight</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-special" style="color: #ff79c6;">derive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Debug</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
<span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">LocalDef</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">name</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">value_range</span>: <span class="ahl-namespace" style="color: #f8f8f2;">ops</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-special" style="color: #ff79c6;">derive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Debug</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
<span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">LocalScope</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">inherits</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">bool</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">range</span>: <span class="ahl-namespace" style="color: #f8f8f2;">ops</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">LocalDef</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span>
<span class="ahl-keyword" style="color: #ff79c6;">where</span>
    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">FnMut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlighter</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_callback</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cancellation_flag</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">AtomicUsize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">iter_count</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">next_event</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">last_highlight_range</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">struct</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">_tree</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Tree</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursor</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCursor</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span>: <span class="ahl-namespace" style="color: #f8f8f2;">iter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Peekable</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCaptures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">LocalScope</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">ranges</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">depth</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Default</span> <span class="ahl-keyword" style="color: #ff79c6;">for</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlighter</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">default</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlighter</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">must_use</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-constructor" style="color: #BD93F9;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursors</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">parser</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Parser</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Iterate over the highlighted regions for a given slice of source code.</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">cancellation_flag</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">AtomicUsize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_callback</span>: <span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">FnMut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Iterator</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Item</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">layers</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">cancellation_flag</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_callback</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-function ahl-macro" style="color: #BD93F9;">vec</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constructor" style="color: #BD93F9;">Range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span>: <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span>: <span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-special" style="color: #ff79c6;">?</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-function ahl-macro" style="color: #BD93F9;">assert_ne</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">HighlightIter</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span>: <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span>: <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_callback</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">cancellation_flag</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlighter</span>: <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">iter_count</span>: <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">next_event</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">last_highlight_range</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Creates a `HighlightConfiguration` for a given `Language` and set of highlighting</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; queries.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; # Parameters</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; * `language`  - The Tree-sitter `Language` that should be used for parsing.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; * `highlights_query` - A string containing tree patterns for syntax highlighting. This</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;   should be non-empty, otherwise no syntax highlights will be added.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; * `injections_query` -  A string containing tree patterns for injecting other languages</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;   into the document. This can be empty if no injections are desired.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; * `locals_query` - A string containing tree patterns for tracking local variable</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;   definitions and references. This can be empty if local variable tracking is not needed.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Returns a `HighlightConfiguration` that can then be used with the `highlight` method.</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">language</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">name</span>: <span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Into</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">String</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlights_query</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_query</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">locals_query</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryError</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Concatenate the query strings, keeping track of the start offset of each section.</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">query_source</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">String</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push_str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">locals_query_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push_str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">locals_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">highlights_query_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push_str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlights_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Construct a single query by concatenating the three query strings, but record the</span>
        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; range of pattern indices that belong to each individual string.</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">query</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">query_source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-special" style="color: #ff79c6;">?</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">locals_pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">highlights_pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pattern_count</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">pattern_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_byte_for_pattern</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">pattern_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">highlights_query_offset</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">pattern_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">highlights_query_offset</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">highlights_pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">pattern_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">locals_query_offset</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">locals_pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Construct a separate query just for dealing with the &#x27;combined injections&#x27;.</span>
        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Disable the combined injection patterns in the main query.</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-special" style="color: #ff79c6;">?</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">has_combined_queries</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">pattern_index</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-variable" style="color: #f8f8f2;">locals_pattern_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">settings</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">property_settings</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">settings</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">any</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">s</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">s</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">key</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.combined&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">has_combined_queries</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">disable_pattern</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">disable_pattern</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">has_combined_queries</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Find all of the highlighting patterns that are disabled for nodes that</span>
        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; have been identified as local variables.</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">non_local_variable_patterns</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pattern_count</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">query</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">property_predicates</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">any</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">positive</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">positive</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">key</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-string" style="color: #f1fa8c;">&quot;local&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">collect</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

        <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Store the numeric ids for all of the special captures.</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">injection_content_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">injection_language_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">local_def_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">local_def_value_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">local_ref_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">local_scope_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">capture_names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">enumerate</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">name</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.content&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">injection_content_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.language&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">injection_language_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;local.definition&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">local_def_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;local.definition-value&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">local_def_value_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;local.reference&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">local_ref_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-string" style="color: #f1fa8c;">&quot;local.scope&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">local_scope_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                _ <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">highlight_indices</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-function ahl-macro" style="color: #BD93F9;">vec</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span> <span class="ahl-variable" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">capture_names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">language</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span>: <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">into</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">locals_pattern_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlights_pattern_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_indices</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">non_local_variable_patterns</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_content_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_language_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_value_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_ref_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_scope_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Get a slice containing all of the highlight names used in the configuration.</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">must_use</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">const</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">capture_names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Set the list of recognized highlight names.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Tree-sitter syntax-highlighting queries specify highlights in the form of dot-separated</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; highlight names like `punctuation.bracket` and `function.method.builtin`. Consumers of</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; these queries can choose to recognize highlights with different levels of specificity.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; For example, the string `function.builtin` will match against `function.method.builtin`</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; and `function.builtin.constructor`, but will not match `function.method`.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; When highlighting, results are returned as `Highlight` values, which contain the index</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; of the matched highlight this list of highlight names.</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">configure</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">recognized_names</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">AsRef</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">capture_parts</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_indices</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_indices</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">capture_names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">move</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">capture_parts</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable" style="color: #f8f8f2;">capture_parts</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">split</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;.&#x27;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">best_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">best_match_len</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">recognized_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">recognized_names</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">enumerate</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">len</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">matches</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">part</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">recognized_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">split</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;.&#x27;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">len</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable" style="color: #f8f8f2;">capture_parts</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">contains</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">part</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">matches</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">matches</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">len</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">best_match_len</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">best_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">best_match_len</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">len</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-variable" style="color: #f8f8f2;">best_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Return the list of this configuration&#x27;s capture names that are neither present in the</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; list of predefined &#x27;canonical&#x27; names nor start with an underscore (denoting &#x27;private&#x27; captures</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; used as part of capture internals).</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">must_use</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">nonconformant_capture_names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_names</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HashSet</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_names</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_names</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-constant" style="color: #BD93F9;">STANDARD_CAPTURE_NAMES</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_names</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">names</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">filter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">n</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">n</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">starts_with</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;_&#x27;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">||</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capture_names</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">contains</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">n</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">copied</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">collect</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; Create a new &#x27;layer&#x27; of highlighting for this document.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f;</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; In the even that the new layer contains &quot;combined injections&quot; (injections where multiple</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; disjoint ranges are parsed as one syntax tree), these will be eagerly processed and</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;&#x2f; added to the returned vector.</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">allow</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">clippy</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">too_many_arguments</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">FnMut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_name</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">cancellation_flag</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">AtomicUsize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_callback</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">depth</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">with_capacity</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">queue</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">loop</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">set_included_ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">set_language</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map_err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span>_<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">InvalidLanguage</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-special" style="color: #ff79c6;">?</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-keyword" style="color: #ff79c6;">unsafe</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">set_cancellation_flag</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">cancellation_flag</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">tree</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">parse</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">ok_or</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Cancelled</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-special" style="color: #ff79c6;">?</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword" style="color: #ff79c6;">unsafe</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">parser</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">set_cancellation_flag</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursors</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap_or_default</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Process combined injections.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">combined_injections_query</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">injections_by_pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span>
                        <span class="ahl-function ahl-macro" style="color: #BD93F9;">vec</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span> <span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pattern_count</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">matches</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">cursor</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">matches</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">tree</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">root_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">mat</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">matches</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">entry</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">injections_by_pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">mat</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-function" style="color: #50fa7b;">injection_for_match</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
                            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">combined_injections_query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">mat</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">entry</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">entry</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">entry</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">2</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">lang_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_nodes</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">includes_children</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">injections_by_pattern_index</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">lang_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">lang_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_nodes</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_config</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">injection_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">lang_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">intersect_ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
                                    <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                    <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">content_nodes</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                    <span class="ahl-variable" style="color: #f8f8f2;">includes_children</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                    <span class="ahl-variable" style="color: #f8f8f2;">queue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">depth</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; The `captures` iterator borrows the `Tree` and the `QueryCursor`, which</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; prevents them from being moved. But both of these values are really just</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; pointers, so it&#x27;s actually ok to move them.</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">tree_ref</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-keyword" style="color: #ff79c6;">unsafe</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-namespace" style="color: #f8f8f2;">mem</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">transmute</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">static</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Tree</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">tree</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor_ref</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span>
                    <span class="ahl-keyword" style="color: #ff79c6;">unsafe</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-namespace" style="color: #f8f8f2;">mem</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">transmute</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">static</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryCursor</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">captures</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor_ref</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">tree_ref</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">root_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">peekable</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">HighlightIterLayer</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span>: <span class="ahl-function ahl-macro" style="color: #BD93F9;">vec</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">!</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constructor" style="color: #BD93F9;">LocalScope</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">inherits</span>: <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">range</span>: <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;"><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span></span><span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;"></span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursor</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">depth</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">_tree</span>: <span class="ahl-variable" style="color: #f8f8f2;">tree</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">queue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">next_depth</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">next_ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">queue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">remove</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">depth</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_depth</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">ranges</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

        <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Compute the ranges that should be included when parsing an injection.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; This takes into account three things:</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; * `parent_ranges` - The ranges must all fall within the *current* layer&#x27;s ranges.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; * `nodes` - Every injection takes place within a set of nodes. The injection ranges</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;   are the ranges of those nodes.</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; * `includes_children` - For some injections, the content nodes&#x27; children should be</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;   excluded from the nested document, so that only the content nodes&#x27; *own* content</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;   is reparsed. For other injections, the content nodes&#x27; entire ranges should be</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f;   reparsed, including the ranges of their children.</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">intersect_ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_ranges</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">nodes</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">includes_children</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">bool</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">nodes</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">walk</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range_iter</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range_iter</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">expect</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">&quot;Layers should only be constructed with non-empty ranges vectors&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">node</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">nodes</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">preceding_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span>: <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_byte</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_position</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">following_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">end_byte</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">end_position</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span>: <span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-namespace" style="color: #f8f8f2;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constant" style="color: #BD93F9;">MAX</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

            <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">excluded_range</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">node</span>
                <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">children</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">cursor</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">filter_map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">child</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">includes_children</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">child</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">chain</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-namespace" style="color: #f8f8f2;">std</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">iter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">once</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">following_range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">preceding_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">preceding_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">excluded_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">excluded_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable" style="color: #f8f8f2;">preceding_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">excluded_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;=</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span>: <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                    <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span>: <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_point</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_point</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end_byte</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                            <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">parent_range_iter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">parent_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-variable" style="color: #f8f8f2;">result</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; First, sort scope boundaries by their byte offset in the document. At a</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; given position, emit scope endings before scope beginnings. Finally, emit</span>
    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; scope boundaries from deeper layers first.</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">bool</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">isize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">depth</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-operator" style="color: #f8f8f2;">-</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">depth</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">isize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">next_start</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">peek</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">m</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-variable" style="color: #f8f8f2;">m</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_byte</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">next_end</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">copied</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">next_end</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">start</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">start</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">end</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">j</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">j</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            _ <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span>
<span class="ahl-keyword" style="color: #ff79c6;">where</span>
    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">FnMut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">emit_event</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">offset</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">event</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">offset</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Source</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span>: <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span>: <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">offset</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">offset</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">next_event</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">event</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">event</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">result</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_offset</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">next_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">sort_key</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">rotate_left</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">remove</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursors</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cursor</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">insert_layer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">layer</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">sort_key_i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_key</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">sort_key_i</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">sort_key</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">insert</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">layer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">remove</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">layer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Iterator</span> <span class="ahl-keyword" style="color: #ff79c6;">for</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span>
<span class="ahl-keyword" style="color: #ff79c6;">where</span>
    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">FnMut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-storage ahl-type" style="font-style: italic; color: #8be9fd;">type</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Item</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Item</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">main</span>: <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">loop</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If we&#x27;ve already determined the next highlight boundary, just return it.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">e</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">next_event</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">take</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">e</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Periodically check for cancellation, returning `Cancelled` error if the</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; cancellation flag was flipped.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">cancellation_flag</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cancellation_flag</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">iter_count</span> <span class="ahl-operator" style="color: #f8f8f2;">+=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">iter_count</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;=</span> <span class="ahl-constant" style="color: #BD93F9;">CANCELLATION_CHECK_INTERVAL</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">iter_count</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">cancellation_flag</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">load</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Ordering</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Relaxed</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">!=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Cancelled</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If none of the layers have any more highlight boundaries, terminate.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Source</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span>: <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span>: <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">byte_offset</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">result</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Get the next capture from whichever layer has the earliest highlight boundary.</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">peek</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable" style="color: #f8f8f2;">range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">byte_range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If any previous highlight ends before this node starts, then before</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; processing this capture, emit the source code up until the end of the</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; previous highlight, and an end event for that highlight.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">copied</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">end_byte</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;=</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">emit_event</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEnd</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If there are no more captures, then emit any remaining highlight end events.</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; And if there are none of those, then just advance to the end of the document.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">copied</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">emit_event</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">end_byte</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEnd</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">emit_event</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If this capture represents an injection, then process the injection.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">locals_pattern_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-function" style="color: #50fa7b;">injection_for_match</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Explicitly remove this match so that none of its other captures will remain</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; in the stream of captures.</span>
                <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">remove</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If a language is found with the given name, then add a new language layer</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; to the highlighted document.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">ranges</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">intersect_ranges</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
                            <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">include_children</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable" style="color: #f8f8f2;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightIterLayer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
                                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlighter</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">cancellation_flag</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_callback</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">depth</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">ranges</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">layers</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">insert_layer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                                <span class="ahl-constructor" style="color: #BD93F9;">Err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">e</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">Err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">e</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">main</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Remove from the local scope stack any local scopes that have already ended.</span>
            <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If this capture is for tracking local variables, then process the</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; local variable info.</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">reference_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlights_pattern_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If the node represents a local scope, push a new local scope onto</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; the scope stack.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_scope_capture_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">scope</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">LocalScope</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">inherits</span>: <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">range</span>: <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clone</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">property_settings</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">key</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-string" style="color: #f1fa8c;">&quot;local.scope-inherits&quot;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">inherits</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">value</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map_or</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">r</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">r</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-string" style="color: #f1fa8c;">&quot;true&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If the node represents a definition, add a new definition to the</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; local scope at the top of the scope stack.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_capture_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">reference_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">scope</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last_mut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">value_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_def_value_capture_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">value_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">byte_range</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-namespace" style="color: #f8f8f2;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">from_utf8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clone</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constructor" style="color: #BD93F9;">LocalDef</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">value_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span>
                            <span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last_mut</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">s</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">s</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If the node represents a reference, then try to find the corresponding</span>
                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; definition in the scope stack.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_ref_capture_index</span>
                    <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_none</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">name</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-namespace" style="color: #f8f8f2;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">from_utf8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clone</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">scope</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">scope_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">rev</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">local_defs</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">rev</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">find_map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">def</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">def</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">name</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">name</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">def</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">value_range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                    <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">def</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                    <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span>
                                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-variable" style="color: #f8f8f2;">reference_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable" style="color: #f8f8f2;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">inherits</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Continue processing any additional matches for the same node.</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">peek</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">next_capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-variable" style="color: #f8f8f2;">match_</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">main</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Otherwise, this capture must represent a highlight.</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If this exact range has already been highlighted by an earlier pattern, or by</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; a different layer, then skip over this one.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">last_start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">last_end</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">last_depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">last_highlight_range</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">last_start</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">last_end</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">depth</span> <span class="ahl-operator" style="color: #f8f8f2;">&lt;</span> <span class="ahl-variable" style="color: #f8f8f2;">last_depth</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">main</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Once a highlighting pattern is found for the current node, keep iterating over</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; any later highlighting patterns that also match this node and set the match to it.</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Captures for a given node are ordered by pattern index, so these subsequent</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; captures are guaranteed to be for highlighting, not injections or</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; local variables.</span>
            <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">while</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">peek</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">next_capture_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">following_match</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">next</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If the current node was found to be a local variable, then ignore</span>
                    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; the following match if it&#x27;s a highlighting pattern that is disabled</span>
                    <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; for local variables.</span>
                    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">||</span> <span class="ahl-variable" style="color: #f8f8f2;">reference_highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                        <span class="ahl-operator" style="color: #f8f8f2;">&amp;&amp;</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">non_local_variable_patterns</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">following_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                        <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">match_</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">remove</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">capture</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">next_capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">match_</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">following_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">break</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">current_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_indices</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; If this node represents a local definition, then store the current</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; highlight value on the local scope entry representing this node.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">definition_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">current_highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Emit a scope start event and push the node&#x27;s end position to the stack.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">reference_highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">or</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">current_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">last_highlight_range</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">depth</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable" style="color: #f8f8f2;">layer</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">highlight_end_stack</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">emit_event</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">range</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constructor" style="color: #BD93F9;">HighlightStart</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">sort_layers</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Default</span> <span class="ahl-keyword" style="color: #ff79c6;">for</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HtmlRenderer</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">default</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HtmlRenderer</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">#</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-function ahl-macro" style="color: #BD93F9;">must_use</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span>
    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">result</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Self</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">with_capacity</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant" style="color: #BD93F9;">BUFFER_HTML_RESERVE_CAPACITY</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">with_capacity</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant" style="color: #BD93F9;">BUFFER_LINES_RESERVE_CAPACITY</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">carriage_return_highlight</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">result</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable" style="color: #f8f8f2;">result</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">set_carriage_return_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlight</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">carriage_return_highlight</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">reset</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-function" style="color: #50fa7b;">shrink_and_clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant" style="color: #BD93F9;">BUFFER_HTML_RESERVE_CAPACITY</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-function" style="color: #50fa7b;">shrink_and_clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-constant" style="color: #BD93F9;">BUFFER_LINES_RESERVE_CAPACITY</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">0</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">render</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
        <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span>: <span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Iterator</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Item</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Result</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Error</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span>
    <span class="ahl-keyword" style="color: #ff79c6;">where</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Fn</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">highlights</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">event</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlighter</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-variable" style="color: #f8f8f2;">event</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constructor" style="color: #BD93F9;">HighlightStart</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">s</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">highlights</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">s</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">s</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEnd</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">highlights</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">end_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightEvent</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-constructor" style="color: #BD93F9;">Source</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">start</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">end</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">add_text</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">start</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-variable" style="color: #f8f8f2;">end</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable" style="color: #f8f8f2;">highlights</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-constructor" style="color: #BD93F9;">Err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">return</span> <span class="ahl-constructor" style="color: #BD93F9;">Err</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">!=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-constant ahl-character" style="color: #8be9fd;">b&#x27;\n&#x27;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-constant ahl-character" style="color: #8be9fd;">b&#x27;\n&#x27;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">last</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">pop</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-constructor" style="color: #BD93F9;">Ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">lines</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword" style="color: #ff79c6;">impl</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Iterator</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Item</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">enumerate</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">move</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">i</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">line_start</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">line_start</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable" style="color: #f8f8f2;">line_start</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">line_end</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">i</span> <span class="ahl-operator" style="color: #f8f8f2;">+</span> <span class="ahl-constant ahl-numeric integer" style="color: #BD93F9;">1</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-namespace" style="color: #f8f8f2;">str</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">from_utf8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">&amp;</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-variable" style="color: #f8f8f2;">line_start</span><span class="ahl-operator" style="color: #f8f8f2;">..</span><span class="ahl-variable" style="color: #f8f8f2;">line_end</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">unwrap</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">add_carriage_return</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-keyword" style="color: #ff79c6;">where</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Fn</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">carriage_return_highlight</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&lt;span &quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&gt;&lt;&#x2f;span&gt;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">start_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">h</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-keyword" style="color: #ff79c6;">where</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Fn</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">h</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&lt;span&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-operator" style="color: #f8f8f2;">!</span><span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_empty</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot; &quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">attribute_string</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&gt;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">end_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&lt;&#x2f;span&gt;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">add_text</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">src</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlights</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
    <span class="ahl-keyword" style="color: #ff79c6;">where</span>
        <span class="ahl-type" style="font-style: italic; color: #8be9fd;">F</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Fn</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword" style="color: #ff79c6;">pub</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">const</span> <span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">html_escape</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">c</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">static</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">c</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">char</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;&gt;&#x27;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&amp;gt;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;&lt;&#x27;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&amp;lt;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;&amp;&#x27;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&amp;amp;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;\&#x27;&#x27;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&amp;#39;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                <span class="ahl-constant ahl-character" style="color: #8be9fd;">&#x27;&quot;&#x27;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-string" style="color: #f1fa8c;">b&quot;&amp;quot;&quot;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
                _ <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">last_char_was_cr</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">c</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">LossyUtf8</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-function" style="color: #50fa7b;">new</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">src</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">flat_map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">p</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">p</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">bytes</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Don&#x27;t render carriage return characters, but allow lone carriage returns (not</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; followed by line feeds) to be styled via the attribute callback.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">c</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-constant ahl-character" style="color: #8be9fd;">b&#x27;\r&#x27;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable" style="color: #f8f8f2;">last_char_was_cr</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-keyword ahl-control ahl-return" style="color: #ff79c6;">continue</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">last_char_was_cr</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">c</span> <span class="ahl-operator" style="color: #f8f8f2;">!=</span> <span class="ahl-constant ahl-character" style="color: #8be9fd;">b&#x27;\n&#x27;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">add_carriage_return</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
                <span class="ahl-variable" style="color: #f8f8f2;">last_char_was_cr</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; At line boundaries, close and re-open all of the open tags.</span>
            <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">c</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-constant ahl-character" style="color: #8be9fd;">b&#x27;\n&#x27;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlights</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">for_each</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span>_<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">end_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">c</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">line_offsets</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-keyword ahl-operator" style="color: #ff79c6;">as</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">u32</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">highlights</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">iter</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
                    <span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">for_each</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">scope</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">|</span> <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">start_highlight</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-operator" style="color: #f8f8f2;">*</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">scope</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">attribute_callback</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">escape</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-function" style="color: #50fa7b;">html_escape</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">c</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">extend_from_slice</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">escape</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-variable ahl-builtin" style="font-style: italic; color: #BD93F9;">self</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">html</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">push</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">c</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">injection_for_match</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">HighlightConfiguration</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_name</span>: <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">query</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">query_match</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">QueryMatch</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">[</span><span class="ahl-type ahl-builtin" style="color: #8be9fd;">u8</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">]</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">-&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Option</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">Node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-label" style="color: #8be9fd;">&#x27;</span><span class="ahl-label" style="color: #8be9fd;">a</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-type ahl-builtin" style="color: #8be9fd;">bool</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">content_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_content_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">language_capture_index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">injection_language_capture_index</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">None</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>

    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">query_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">captures</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-variable" style="color: #f8f8f2;">index</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">index</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">language_capture_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable" style="color: #f8f8f2;">language_name</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">utf8_text</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">source</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">ok</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">else</span> <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">index</span> <span class="ahl-operator" style="color: #f8f8f2;">==</span> <span class="ahl-variable" style="color: #f8f8f2;">content_capture_index</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-variable" style="color: #f8f8f2;">content_node</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">capture</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">node</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-keyword ahl-storage" style="color: #ff79c6;">let</span> <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">false</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-keyword ahl-control ahl-repeat" style="color: #ff79c6;">for</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span> <span class="ahl-keyword ahl-control" style="color: #ff79c6;">in</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">query</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">property_settings</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">query_match</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">pattern_index</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">match</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">key</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; In addition to specifying the language name via the text of a</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; captured node, it can also be hard-coded via a `#set!` predicate</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; that sets the injection.language key.</span>
            <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.language&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_none</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">language_name</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable" style="color: #f8f8f2;">prop</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">value</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">map</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-namespace" style="color: #f8f8f2;">std</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">convert</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">AsRef</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">::</span><span class="ahl-namespace" style="color: #f8f8f2;">as_ref</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Setting the `injection.self` key can be used to specify that the</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; language name should be the same as the language of the current</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; layer.</span>
            <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.self&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_none</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">language_name</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constructor" style="color: #BD93F9;">Some</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">config</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-variable ahl-other ahl-member" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">as_str</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; Setting the `injection.parent` key can be used to specify that</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; the language name should be the same as the language of the</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; parent layer</span>
            <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.parent&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">is_none</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
                    <span class="ahl-variable" style="color: #f8f8f2;">language_name</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">parent_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
                <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
            <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; By default, injections do not include the *children* of an</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; `injection.content` node - only the ranges that belong to the</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; node itself. This can be changed using a `#set!` predicate that</span>
            <span class="ahl-comment" style="color: #6272A4;">&#x2f;&#x2f; sets the `injection.include-children` key.</span>
            <span class="ahl-string" style="color: #f1fa8c;">&quot;injection.include-children&quot;</span> <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span> <span class="ahl-operator" style="color: #f8f8f2;">=</span> <span class="ahl-constant ahl-builtin boolean" style="color: #BD93F9;">true</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span>
            _ <span class="ahl-operator" style="color: #f8f8f2;">=&gt;</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
        <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable" style="color: #f8f8f2;">language_name</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">content_node</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable" style="color: #f8f8f2;">include_children</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>

<span class="ahl-keyword ahl-function" style="color: #ff79c6;">fn</span> <span class="ahl-function" style="color: #50fa7b;">shrink_and_clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">T</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">vec</span>: <span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">&amp;</span><span class="ahl-keyword ahl-storage ahl-modifier" style="color: #ff79c6;">mut</span> <span class="ahl-type" style="font-style: italic; color: #8be9fd;">Vec</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&lt;</span><span class="ahl-type" style="font-style: italic; color: #8be9fd;">T</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">&gt;</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">,</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capacity</span>: <span class="ahl-type ahl-builtin" style="color: #8be9fd;">usize</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
    <span class="ahl-keyword ahl-control ahl-conditional" style="color: #ff79c6;">if</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">len</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span> <span class="ahl-operator" style="color: #f8f8f2;">&gt;</span> <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capacity</span> <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">{</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">truncate</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">capacity</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
        <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">shrink_to_fit</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
    <span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
    <span class="ahl-variable ahl-parameter" style="font-style: italic; color: #ffb86c;">vec</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">.</span><span class="ahl-function" style="color: #50fa7b;">clear</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">(</span><span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">)</span><span class="ahl-punctuation ahl-delimiter" style="color: #f8f8f2;">;</span>
<span class="ahl-punctuation ahl-bracket" style="color: #f8f8f2;">}</span>
</code></pre>
</body>
</html>
