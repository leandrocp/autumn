<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Autumn Sample - javascript - onedark</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'JetBrains Mono', monospace;
      line-height: 1.5;
    }
    pre {
      font-size: 15px;
      margin: 20px;
    }
  </style>
  <style>
  * {
    color: #ABB2BF;
  }
  body {
    background-color: #282C34;
  }
</style>

</head>
<body>
  
  <pre class="autumn highlight" style="background-color: #282C34; color: #ABB2BF;">
<code class="language-javascript" translate="no">
<span class="keyword" style="color: #E06C75;">import</span> <span class="" style="color: #ABB2BF;">{</span>
  <span class="constant" style="color: #56B6C2;">BEFORE_UNLOAD_LOADER_TIMEOUT</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">CHECKABLE_INPUTS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">CONSECUTIVE_RELOADS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_AUTO_RECOVER</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_COMPONENT</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_CONNECTED_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH_RESTORE</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_DISABLED</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_EVENT_CLASSES</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_CLIENT_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_SERVER_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_FEEDBACK_FOR</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_HAS_SUBMITTED</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_PAGE_LOADING</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_PARENT_ID</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_PROGRESS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_READONLY</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_ROOT_ID</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_SESSION</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_STATIC</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_TRACK_STATIC</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_TRACK_UPLOADS</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_UPDATE</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_UPLOAD_REF</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_VIEW_SELECTOR</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_MAIN</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_MOUNTED</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PUSH_TIMEOUT</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_VIEWPORT_TOP</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="constant" style="color: #56B6C2;">PHX_VIEWPORT_BOTTOM</span><span class="" style="color: #ABB2BF;">,</span>
<span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;constants&quot;</span>

<span class="keyword" style="color: #E06C75;">import</span> <span class="" style="color: #ABB2BF;">{</span>
  <span class="" style="color: #ABB2BF;">clone</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">closestPhxBinding</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">isEmpty</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">isEqualObj</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">logError</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">maybe</span><span class="" style="color: #ABB2BF;">,</span>
  <span class="" style="color: #ABB2BF;">isCid</span><span class="" style="color: #ABB2BF;">,</span>
<span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;utils&quot;</span>

<span class="keyword" style="color: #E06C75;">import</span> <span class="constructor" style="color: #61AFEF;">Browser</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;browser&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constant" style="color: #56B6C2;">DOM</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;dom&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constructor" style="color: #61AFEF;">DOMPatch</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;dom_patch&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constructor" style="color: #61AFEF;">LiveUploader</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;live_uploader&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constructor" style="color: #61AFEF;">Rendered</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;rendered&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constructor" style="color: #61AFEF;">ViewHook</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;view_hook&quot;</span>
<span class="keyword" style="color: #E06C75;">import</span> <span class="constant" style="color: #56B6C2;">JS</span> <span class="keyword" style="color: #E06C75;">from</span> <span class="string" style="color: #98C379;">&quot;.&#x2f;js&quot;</span>

<span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">serializeForm</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">metadata</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onlyNames</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
  <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>submitter<span class="" style="color: #ABB2BF;">,</span> ...<span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">metadata</span>

  <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; TODO: Replace with `new FormData(form, submitter)` when supported by latest browsers,</span>
  <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f;       and mention `formdata-submitter-polyfill` in the docs.</span>
  <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">formData</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">FormData</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">)</span>

  <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; TODO: Remove when FormData constructor supports the submitter argument.</span>
  <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">submitter</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;name&quot;</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">.</span>form <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">.</span>form <span class="operator" style="color: #C678DD;">===</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">append</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">.</span>name<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">.</span>value<span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">toRemove</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>

  <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">val</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_index</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">val</span> <span class="keyword" style="color: #E06C75;">instanceof</span> <span class="constructor" style="color: #61AFEF;">File</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">toRemove</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

  <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; Cleanup after building fileData</span>
  <span class="" style="color: #ABB2BF;">toRemove</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">key</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">delete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>

  <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">params</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">URLSearchParams</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">val</span><span class="" style="color: #ABB2BF;">]</span> <span class="keyword" style="color: #E06C75;">of</span> <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">entries</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">onlyNames</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0 <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">onlyNames</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">indexOf</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&gt;=</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">append</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">val</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>
  <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">metaKey</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">append</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">metaKey</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">metaKey</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">toString</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
<span class="" style="color: #ABB2BF;">}</span>

<span class="keyword" style="color: #E06C75;">export</span> <span class="keyword" style="color: #E06C75;">default</span> <span class="keyword" style="color: #E06C75;">class</span> <span class="constructor" style="color: #61AFEF;">View</span> <span class="" style="color: #ABB2BF;">{</span>
  <span class="function" style="color: #61AFEF;">constructor</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">liveSocket</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">parentView</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">flash</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">liveReferer</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>isDead <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">liveSocket</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>flash <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">flash</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">parentView</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">parentView</span> ? <span class="" style="color: #ABB2BF;">parentView</span><span class="" style="color: #ABB2BF;">.</span>root : <span class="variable builtin" style="color: #61AFEF;">this</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span>id
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>ref <span class="operator" style="color: #C678DD;">=</span> 0
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>childJoins <span class="operator" style="color: #C678DD;">=</span> 0
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>loaderTimer <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingDiffs <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pruningCIDs <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>redirect <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent ? <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">-</span> 1 : 0
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinPending <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>destroyed <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinCallback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">onDone</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">stopCallback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingJoinOps <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent ? <span class="constant builtin" style="color: #D19A66;">null</span> : <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>uploaders <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>formSubmits <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>children <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent ? <span class="constant builtin" style="color: #D19A66;">null</span> : <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">channel</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`lv:<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">}</span>`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">url</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">expandURL</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">{</span>
        redirect: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>redirect ? <span class="" style="color: #ABB2BF;">url</span> : <span class="constant builtin" style="color: #D19A66;">undefined</span><span class="" style="color: #ABB2BF;">,</span>
        url: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>redirect ? <span class="constant builtin" style="color: #D19A66;">undefined</span> : <span class="" style="color: #ABB2BF;">url</span> <span class="operator" style="color: #C678DD;">||</span> <span class="constant builtin" style="color: #D19A66;">undefined</span><span class="" style="color: #ABB2BF;">,</span>
        params: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">connectParams</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">liveReferer</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        session: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getSession</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        static: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getStatic</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        flash: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>flash<span class="" style="color: #ABB2BF;">,</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">setHref</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">href</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">setRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>redirect <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">href</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_MAIN</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">connectParams</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">liveReferer</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">params</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">params</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">manifest</span> <span class="operator" style="color: #C678DD;">=</span>
      <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_TRACK_STATIC</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">map</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">node</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">node</span><span class="" style="color: #ABB2BF;">.</span>src <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">node</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">url</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="keyword" style="color: #E06C75;">typeof</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">url</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;string&quot;</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">manifest</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;_track_static&quot;</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">manifest</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;_mounts&quot;</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount
    <span class="" style="color: #ABB2BF;">params</span><span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;_live_referer&quot;</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">liveReferer</span>

    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">params</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">canPush</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getSession</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_SESSION</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getStatic</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">val</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_STATIC</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">val</span> <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;&quot;</span> ? <span class="constant builtin" style="color: #D19A66;">null</span> : <span class="" style="color: #ABB2BF;">val</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">destroy</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">callback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroyAllChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>destroyed <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="keyword" style="color: #E06C75;">delete</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">delete</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="function" style="color: #61AFEF;">clearTimeout</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>loaderTimer<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">onFinished</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">id</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroyHook</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">markPhxChildDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">)</span>

    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;destroyed&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;the child has been removed from the parent&quot;</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">leave</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;ok&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">onFinished</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">onFinished</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;timeout&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">onFinished</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">setContainerClasses</span><span class="" style="color: #ABB2BF;">(</span>...<span class="" style="color: #ABB2BF;">classes</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span>classList<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">remove</span><span class="" style="color: #ABB2BF;">(</span>
      <span class="constant" style="color: #56B6C2;">PHX_CONNECTED_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
      <span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
      <span class="constant" style="color: #56B6C2;">PHX_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
      <span class="constant" style="color: #56B6C2;">PHX_CLIENT_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span>
      <span class="constant" style="color: #56B6C2;">PHX_SERVER_ERROR_CLASS</span>
    <span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span>classList<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">add</span><span class="" style="color: #ABB2BF;">(</span>...<span class="" style="color: #ABB2BF;">classes</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">showLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">timeout</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="function" style="color: #61AFEF;">clearTimeout</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>loaderTimer<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">timeout</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>loaderTimer <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">setTimeout</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">timeout</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">id</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__disconnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setContainerClasses</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">execAll</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">binding</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">binding</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">execJS</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">binding</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">hideLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="function" style="color: #61AFEF;">clearTimeout</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>loaderTimer<span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setContainerClasses</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_CONNECTED_CLASS</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">execAll</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;connected&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">triggerReconnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">id</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__reconnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">msgCallback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">msgCallback</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">transition</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">time</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onStart</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onDone</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">transition</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">time</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onStart</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">withinTargets</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span> <span class="keyword" style="color: #E06C75;">instanceof</span> <span class="constructor" style="color: #61AFEF;">HTMLElement</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">phxTarget</span> <span class="keyword" style="color: #E06C75;">instanceof</span> <span class="constructor" style="color: #61AFEF;">SVGElement</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">owner</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">view</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">targets</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findComponentNodeList</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targets</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`no component found matching phx-target of <span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">}</span>`</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">parseInt</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">targets</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">Array</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">from</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">querySelectorAll</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targets</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`nothing found matching the phx-target selector &quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxTarget</span><span class="" style="color: #ABB2BF;">}</span>&quot;`</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">targets</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">target</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">owner</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">target</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">view</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">target</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">applyDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">type</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">rawDiff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">type</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">clone</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">rawDiff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> reply<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">,</span> title<span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">Rendered</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">extract</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">rawDiff</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> reply<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">title</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestAnimationFrame</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putTitle</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">title</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onJoin</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>rendered<span class="" style="color: #ABB2BF;">,</span> container<span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">resp</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">container</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">tag</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">attrs</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">container</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">replaceRootContainer</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">tag</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">attrs</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>childJoins <span class="operator" style="color: #C678DD;">=</span> 0
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinPending <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>flash <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">null</span>

    <span class="constructor" style="color: #61AFEF;">Browser</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dropLocal</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span>localStorage<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">.</span>location<span class="" style="color: #ABB2BF;">.</span>pathname<span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">CONSECUTIVE_RELOADS</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;mount&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">rendered</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">Rendered</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">renderContainer</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;join&quot;</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dropPendingRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">forms</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">formsForRecovery</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount<span class="operator" style="color: #C678DD;">++</span>

      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">forms</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">forms</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newCid</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">i</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushFormRecovery</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newCid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">i</span> <span class="operator" style="color: #C678DD;">===</span> <span class="" style="color: #ABB2BF;">forms</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">-</span> 1<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
              <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onJoinComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
            <span class="" style="color: #ABB2BF;">}</span>
          <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onJoinComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">dropPendingRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">}</span>=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">}</span>&quot;][<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onJoinComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>live_patch<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; In order to provide a better experience, we want to join</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; all LiveViews first and only then apply their patches.</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">&gt;</span> 1 <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isJoinPending</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyJoinPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; One downside of this approach is that we need to find phxChildren</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; in the html fragment, instead of directly on the DOM. The fragment</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; also does not include PHX_STATIC, so we need to copy it over from</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; the DOM.</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">newChildren</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findPhxChildrenInFragment</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">toEl</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">fromEl</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">querySelector</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`[id=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">}</span>&quot;]`</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxStatic</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">fromEl</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_STATIC</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxStatic</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_STATIC</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxStatic</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">newChildren</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>pendingJoinOps<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyJoinPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">ackJoin</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onAllChildJoinsComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyJoinPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>pendingJoinOps<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyJoinPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">attachTrueDocEl</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">byId</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_ROOT_ID</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">execNewMounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxViewportTop</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_VIEWPORT_TOP</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxViewportBottom</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_VIEWPORT_BOTTOM</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxViewportTop</span><span class="" style="color: #ABB2BF;">}</span>], [<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxViewportBottom</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">hookEl</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeAddPrivateHooks</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxViewportTop</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxViewportBottom</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeAddNewHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>], [data-phx-<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">hookEl</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeAddNewHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_MOUNTED</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeMounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">applyJoinPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">attachTrueDocEl</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">patch</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">DOMPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">markPrunableContentForRemoval</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">performPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">false</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinNewChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">execNewMounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinPending <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dispatchEvents</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyPendingUpdates</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">live_patch</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>kind<span class="" style="color: #ABB2BF;">,</span> to<span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">live_patch</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">historyPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hideLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">&gt;</span> 1<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerReconnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">stopCallback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">triggerBeforeUpdateHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerDOM</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;onBeforeElUpdated&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">isIgnored</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isIgnored</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_UPDATE</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isEqualNode</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">isIgnored</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="function" style="color: #61AFEF;">isEqualObj</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">.</span>dataset<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">.</span>dataset<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__beforeUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">hook</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">maybeMounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxMounted</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_MOUNTED</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hasBeenInvoked</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">phxMounted</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">private</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;mounted&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxMounted</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">hasBeenInvoked</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">execJS</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxMounted</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putPrivate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;mounted&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">maybeAddNewHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">force</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">newHook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">addHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">newHook</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">newHook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__mounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">performPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">pruneCids</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">removedEls</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxChildrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">updatedHookIds</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">Set</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">after</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;added&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerDOM</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;onNodeAdded&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeAddNewHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>getAttribute<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybeMounted</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">after</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;phxChildAdded&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isPhxSticky</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinRootViews</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">phxChildrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">before</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;updated&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerBeforeUpdateHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">updatedHookIds</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">add</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fromEl</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">after</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;updated&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">updatedHookIds</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">has</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__updated</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">after</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;discarded&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>nodeType <span class="operator" style="color: #C678DD;">===</span> <span class="constructor" style="color: #61AFEF;">Node</span><span class="" style="color: #ABB2BF;">.</span>ELEMENT_NODE<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">removedEls</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">after</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;transitionsDiscarded&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">els</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">afterElementsRemoved</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">els</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">pruneCids</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">perform</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">afterElementsRemoved</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">removedEls</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">pruneCids</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">phxChildrenAdded</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">afterElementsRemoved</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">pruneCids</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">destroyedCIDs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parent</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">components</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parent</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_COMPONENT</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hooks</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parent</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">components</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parent</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">destroyedCIDs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">indexOf</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">===</span> <span class="operator" style="color: #C678DD;">-</span>1<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">destroyedCIDs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">hooks</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parent</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookEl</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookEl</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroyHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; We should not pruneCids on joins. Otherwise, in case of</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; rejoins, we may notify cids that no longer belong to the</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; current LiveView to be removed.</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">pruneCids</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">maybePushComponentsDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">destroyedCIDs</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">joinNewChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findPhxChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getChildById</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">]</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getDescendentByEl</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">===</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_PARENT_ID</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">destroyDescendent</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">parentId</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">childId</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">parentId</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">childId</span> <span class="operator" style="color: #C678DD;">===</span> <span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">parentId</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">childId</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroy</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">joinChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">child</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getChildById</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">child</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">view</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">View</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">view</span>
      <span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">join</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>childJoins<span class="operator" style="color: #C678DD;">++</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">isJoinPending</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinPending <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">ackJoin</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">_child</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>childJoins<span class="operator" style="color: #C678DD;">--</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>childJoins <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>parent<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">ackJoin</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onAllChildJoinsComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onAllChildJoinsComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinCallback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingJoinOps<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">op</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">op</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingJoinOps <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">update</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isJoinPending</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasPendingLink</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingDiffs<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">mergeDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxChildrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>

    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; When the diff only contains component diffs, then walk components</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; and patch only the parent component containers found in the diff.</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; Otherwise, patch entire LV container.</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isComponentOnlyDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">time</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;component patch complete&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">parentCids</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findParentCIDs</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentCIDs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">parentCids</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parentCID</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getComponent</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">parentCID</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">parentCID</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">phxChildrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span> <span class="" style="color: #ABB2BF;">}</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="function" style="color: #61AFEF;">isEmpty</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">time</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;full patch complete&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">renderContainer</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;update&quot;</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">patch</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">DOMPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">phxChildrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">performPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dispatchEvents</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxChildrenAdded</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinNewChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">renderContainer</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">time</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`toString diff (<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">}</span>)`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">tag</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span>tagName
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; Don&#x27;t skip any component in the diff nor any marked as pruned</span>
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; (as they may have been added back)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cids</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">diff</span> ? <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentCIDs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pruningCIDs<span class="" style="color: #ABB2BF;">)</span> : <span class="constant builtin" style="color: #D19A66;">null</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">toString</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cids</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">`&lt;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">tag</span><span class="" style="color: #ABB2BF;">}</span>&gt;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">}</span>&lt;&#x2f;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">tag</span><span class="" style="color: #ABB2BF;">}</span>&gt;`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">componentPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isEmpty</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentToString</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">patch</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">DOMPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">streams</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">childrenAdded</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">performPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">patch</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">childrenAdded</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="constructor" style="color: #61AFEF;">ViewHook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">elementID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">addHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constructor" style="color: #61AFEF;">ViewHook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">elementID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>getAttribute<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hookName</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`data-phx-<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">}</span>`</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_HOOK</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookName</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">ownsElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">callbacks</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getHookCallbacks</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookName</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">callbacks</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`no DOM ID for hook &quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">hookName</span><span class="" style="color: #ABB2BF;">}</span>&quot;. Hooks require a unique ID on each element.`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">ViewHook</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callbacks</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="constructor" style="color: #61AFEF;">ViewHook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">elementID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">hook</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">hook</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookName</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`unknown hook found for &quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">hookName</span><span class="" style="color: #ABB2BF;">}</span>&quot;`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">destroyHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__destroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__cleanup__</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">delete</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>viewHooks<span class="" style="color: #ABB2BF;">[</span><span class="constructor" style="color: #61AFEF;">ViewHook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">elementID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">applyPendingUpdates</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingDiffs<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">update</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pendingDiffs <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">eachChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">child</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">child</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyPendingUpdates</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">eachChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">children</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>children<span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">id</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="" style="color: #ABB2BF;">children</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getChildById</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">id</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cb</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isJoinPending</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>root<span class="" style="color: #ABB2BF;">.</span>pendingJoinOps<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">cb</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestDOMUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">cb</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">bindChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; The diff event should be handled by the regular update operations.</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; All other operations are queued to be applied only after join.</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;diff&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">rawDiff</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestDOMUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;update&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">rawDiff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">update</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;redirect&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to<span class="" style="color: #ABB2BF;">,</span> flash<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to<span class="" style="color: #ABB2BF;">,</span> flash<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;live_patch&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onLivePatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;live_redirect&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onLiveRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onClose</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onClose</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">destroyAllChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">eachChild</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">child</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">child</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroy</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onLiveRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>to<span class="" style="color: #ABB2BF;">,</span> kind<span class="" style="color: #ABB2BF;">,</span> flash<span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">redir</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">url</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">expandURL</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">historyRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">url</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">flash</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onLivePatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">redir</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">{</span>to<span class="" style="color: #ABB2BF;">,</span> kind<span class="" style="color: #ABB2BF;">}</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">redir</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">expandURL</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">historyPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">expandURL</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">startsWith</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;&#x2f;&quot;</span><span class="" style="color: #ABB2BF;">)</span> ? <span class="string" style="color: #98C379;">`<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">.</span>location<span class="" style="color: #ABB2BF;">.</span>protocol<span class="" style="color: #ABB2BF;">}</span>&#x2f;&#x2f;<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">.</span>location<span class="" style="color: #ABB2BF;">.</span>host<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">}</span>`</span> : <span class="" style="color: #ABB2BF;">to</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to<span class="" style="color: #ABB2BF;">,</span> flash<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">redirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">to</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">flash</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>destroyed <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">joinDead</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>isDead <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span> <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">join</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span>loaderTimeout<span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">bindChannel</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>stopCallback <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">withPageLoading</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">,</span> kind: <span class="string" style="color: #98C379;">&quot;initial&quot;</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">joinCallback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">onDone</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">onDone</span> <span class="operator" style="color: #C678DD;">||</span> <span class="keyword" style="color: #E06C75;">function</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">callback</span> ? <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">)</span> : <span class="" style="color: #ABB2BF;">onDone</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">wrapPush</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>timeout: <span class="constant builtin" style="color: #D19A66;">false</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">join</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;ok&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">data</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestDOMUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onJoin</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">data</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onJoinError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;timeout&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onJoinError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>reason: <span class="string" style="color: #98C379;">&quot;timeout&quot;</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onJoinError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>reason <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;reload&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">`failed mount with <span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>status<span class="" style="color: #ABB2BF;">}</span>. Falling back to page request`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">return</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>reason <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;unauthorized&quot;</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>reason <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;stale&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;unauthorized live_redirect. Falling back to page request&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>to: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">return</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>redirect <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinPending <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">leave</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>redirect<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onLiveRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_redirect<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">displayError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_SERVER_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;unable to join&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">reloadWithJitter</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onClose</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasPendingLink</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">reason</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="string" style="color: #98C379;">&quot;leave&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">reloadWithJitter</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">destroyAllChildren</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dropActiveElement</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; document.activeElement can be null in Internet Explorer 11</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">.</span>activeElement<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">.</span>activeElement<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">blur</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isUnloaded</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">BEFORE_UNLOAD_LOADER_TIMEOUT</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">onError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onClose</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;view crashed&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isUnloaded</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">displayError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_SERVER_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">displayError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="constant" style="color: #56B6C2;">PHX_LOADING_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_CLIENT_ERROR_CLASS</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">displayError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">classes</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dispatchEvent</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;phx:page-loading-start&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>detail: <span class="" style="color: #ABB2BF;">{</span>to: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">,</span> kind: <span class="string" style="color: #98C379;">&quot;error&quot;</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showLoader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setContainerClasses</span><span class="" style="color: #ABB2BF;">(</span>...<span class="" style="color: #ABB2BF;">classes</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">execAll</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;disconnected&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">refGenerator</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">refGenerator</span> ? <span class="" style="color: #ABB2BF;">refGenerator</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> : <span class="" style="color: #ABB2BF;">[</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">]</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">onLoadingDone</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>page_loading <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_PAGE_LOADING</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="function" style="color: #61AFEF;">onLoadingDone</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">withPageLoading</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>kind: <span class="string" style="color: #98C379;">&quot;element&quot;</span><span class="" style="color: #ABB2BF;">,</span> target: <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">typeof</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">.</span>cid<span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="string" style="color: #98C379;">&quot;number&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">delete</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">.</span>cid <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">(</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">wrapPush</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>timeout: <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PUSH_TIMEOUT</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;ok&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">finish</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hookReply</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>redirect<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
            <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_patch<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onLivePatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_patch<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
            <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onLiveRedirect</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>live_redirect<span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
            <span class="function" style="color: #61AFEF;">onLoadingDone</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
            <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">hookReply</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span>
          <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>diff<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestDOMUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
              <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyDiff</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;update&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>diff<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">{</span>diff<span class="" style="color: #ABB2BF;">,</span> reply<span class="" style="color: #ABB2BF;">,</span> events<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
                <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">undoRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
                <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">update</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">diff</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">events</span><span class="" style="color: #ABB2BF;">)</span>
                <span class="function" style="color: #61AFEF;">finish</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reply</span><span class="" style="color: #ABB2BF;">)</span>
              <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
            <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">undoRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
            <span class="function" style="color: #61AFEF;">finish</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">undoRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span> <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; exit if external form triggered</span>

    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">}</span>=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">}</span>&quot;][<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">}</span>=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">}</span>&quot;]`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">disabledVal</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLED</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; remove refs</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; restore inputs</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_READONLY</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>readOnly <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">false</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_READONLY</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disabledVal</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>disabled <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">disabledVal</span> <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;true&quot;</span> ? <span class="constant builtin" style="color: #D19A66;">true</span> : <span class="constant builtin" style="color: #D19A66;">false</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLED</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; remove classes</span>
      <span class="constant" style="color: #56B6C2;">PHX_EVENT_CLASSES</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">className</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeClass</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">className</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; restore disables</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">disableRestore</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH_RESTORE</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disableRestore</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>innerText <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">disableRestore</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">removeAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH_RESTORE</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">toEl</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">private</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">hook</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerBeforeUpdateHook</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="constructor" style="color: #61AFEF;">DOMPatch</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">patchEl</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">toEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getActiveElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">hook</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">__updated</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
        <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">deletePrivate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">newRef</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>ref<span class="operator" style="color: #C678DD;">++</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">disableWith</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>loading<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">elements</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>loading<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>

    <span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>classList<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">add</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`phx-<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">}</span>-loading`</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newRef</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF_SRC</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">disableText</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disableWith</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disableText</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH_RESTORE</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
          <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH_RESTORE</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>innerText<span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disableText</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="string" style="color: #98C379;">&quot;&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>innerText <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">disableText</span> <span class="" style="color: #ABB2BF;">}</span>
        <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;disabled&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;&quot;</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">newRef</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">elements</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">]</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">componentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>getAttribute <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_COMPONENT</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">cid</span> ? <span class="function" style="color: #61AFEF;">parseInt</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span> : <span class="constant builtin" style="color: #D19A66;">null</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">target</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">targetCtx</span> <span class="" style="color: #ABB2BF;">}</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cidOrSelector</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>target <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">target</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;target&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cidOrSelector</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="function" style="color: #61AFEF;">parseInt</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cidOrSelector</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cidOrSelector</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">null</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>target<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">closestComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">closestComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">targetCtx</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="function" style="color: #61AFEF;">maybe</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">closest</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`[<span class="" style="color: #ABB2BF;">${</span><span class="constant" style="color: #56B6C2;">PHX_COMPONENT</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">ownsElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">componentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushHookEvent</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isConnected</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;hook&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;unable to push hook event. LiveView not connected&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">false</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">els</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;hook&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">els</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;event&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>
      type: <span class="string" style="color: #98C379;">&quot;hook&quot;</span><span class="" style="color: #ABB2BF;">,</span>
      event: <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span>
      value: <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">,</span>
      cid: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">closestComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">reply</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reply</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">ref</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">extractMeta</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">value</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">prefix</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;value-&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">i</span> <span class="operator" style="color: #C678DD;">=</span> 0<span class="" style="color: #ABB2BF;">;</span> <span class="" style="color: #ABB2BF;">i</span> <span class="operator" style="color: #C678DD;">&lt;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>attributes<span class="" style="color: #ABB2BF;">.</span>length<span class="" style="color: #ABB2BF;">;</span> <span class="" style="color: #ABB2BF;">i</span><span class="operator" style="color: #C678DD;">++</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">meta</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">name</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>attributes<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">i</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span>name
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">startsWith</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">prefix</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">replace</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">prefix</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>value <span class="operator" style="color: #C678DD;">!==</span> <span class="constant builtin" style="color: #D19A66;">undefined</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="keyword" style="color: #E06C75;">instanceof</span> <span class="constructor" style="color: #61AFEF;">HTMLFormElement</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">meta</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">.</span>value <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>value

      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>tagName <span class="operator" style="color: #C678DD;">===</span> <span class="string" style="color: #98C379;">&quot;INPUT&quot;</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="constant" style="color: #56B6C2;">CHECKABLE_INPUTS</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">indexOf</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>type<span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&gt;=</span> 0 <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>checked<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">delete</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">.</span>value
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">value</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">meta</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="keyword" style="color: #E06C75;">for</span><span class="" style="color: #ABB2BF;">(</span><span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">key</span> <span class="keyword" style="color: #E06C75;">in</span> <span class="" style="color: #ABB2BF;">value</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">value</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">key</span><span class="" style="color: #ABB2BF;">]</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">meta</span>
  <span class="" style="color: #ABB2BF;">}</span>


  <span class="function" style="color: #61AFEF;">pushEvent</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">type</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">type</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;event&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>
      type: <span class="" style="color: #ABB2BF;">type</span><span class="" style="color: #ABB2BF;">,</span>
      event: <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span>
      value: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">extractMeta</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>value<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
      cid: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">reply</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">onReply</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">reply</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushFileProgress</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fileEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">entryRef</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">progress</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">function</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">withinOwners</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fileEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;progress&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>
        event: <span class="" style="color: #ABB2BF;">fileEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_PROGRESS</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        ref: <span class="" style="color: #ABB2BF;">fileEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_UPLOAD_REF</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        entry_ref: <span class="" style="color: #ABB2BF;">entryRef</span><span class="" style="color: #ABB2BF;">,</span>
        progress: <span class="" style="color: #ABB2BF;">progress</span><span class="" style="color: #ABB2BF;">,</span>
        cid: <span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">fileEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushInput</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">forceCid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">uploads</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">forceCid</span><span class="" style="color: #ABB2BF;">)</span> ? <span class="" style="color: #ABB2BF;">forceCid</span> : <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">refGenerator</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">formData</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">meta</span>  <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">extractMeta</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">formData</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">serializeForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>_target: <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>_target<span class="" style="color: #ABB2BF;">,</span> ...<span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>name<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">formData</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">serializeForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>_target: <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">.</span>_target<span class="" style="color: #ABB2BF;">,</span> ...<span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isUploadInput</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>files <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>files<span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">trackFiles</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="constructor" style="color: #61AFEF;">Array</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">from</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>files<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">uploads</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">serializeUploads</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">event</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span>
      type: <span class="string" style="color: #98C379;">&quot;form&quot;</span><span class="" style="color: #ABB2BF;">,</span>
      event: <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span>
      value: <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">,</span>
      uploads: <span class="" style="color: #ABB2BF;">uploads</span><span class="" style="color: #ABB2BF;">,</span>
      cid: <span class="" style="color: #ABB2BF;">cid</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">refGenerator</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;event&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">event</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_FEEDBACK_FOR</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isUploadInput</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isAutoUpload</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filesAwaitingPreflight</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_els</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">refGenerator</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">uploadFiles</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">_uploads</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="" style="color: #ABB2BF;">callback</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">triggerAwaitingSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">callback</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">triggerAwaitingSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">awaitingSubmit</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getScheduledSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">awaitingSubmit</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">_el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">awaitingSubmit</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">cancelSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">getScheduledSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>formSubmits<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">find</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_callback</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isSameNode</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">scheduleSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getScheduledSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">true</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>formSubmits<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">cancelSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>formSubmits <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>formSubmits<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_callback</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isSameNode</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">undoRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">false</span>
      <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">true</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">disableForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">filterIgnored</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">userIgnored</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">closestPhxBinding</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`<span class="" style="color: #ABB2BF;">${</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_UPDATE</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">}</span>=ignore`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">userIgnored</span> <span class="operator" style="color: #C678DD;">||</span> <span class="function" style="color: #61AFEF;">closestPhxBinding</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;data-phx-update=ignore&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">filterDisables</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLE_WITH</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">filterButton</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>tagName <span class="operator" style="color: #C678DD;">==</span> <span class="string" style="color: #98C379;">&quot;BUTTON&quot;</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">filterInput</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;INPUT&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;TEXTAREA&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;SELECT&quot;</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">includes</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>tagName<span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">formElements</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">Array</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">from</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">.</span>elements<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">disables</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">formElements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">filterDisables</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">buttons</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">formElements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">filterButton</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">filterIgnored</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">inputs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">formElements</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">filterInput</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">filterIgnored</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="" style="color: #ABB2BF;">buttons</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">button</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">button</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLED</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">button</span><span class="" style="color: #ABB2BF;">.</span>disabled<span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">button</span><span class="" style="color: #ABB2BF;">.</span>disabled <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_READONLY</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>readOnly<span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>readOnly <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>files<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_DISABLED</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>disabled<span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>disabled <span class="operator" style="color: #C678DD;">=</span> <span class="constant builtin" style="color: #D19A66;">true</span>
      <span class="" style="color: #ABB2BF;">}</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_PAGE_LOADING</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">disables</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">buttons</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">concat</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;submit&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushFormSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">refGenerator</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">disableForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasUploadsInProgress</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">_els</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">refGenerator</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">push</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushFormSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">scheduleSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">inputsAwaitingPreflight</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">els</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">refGenerator</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">proxyRefGen</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">els</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">]</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">uploadFiles</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">_uploads</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">meta</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">extractMeta</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">formData</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">serializeForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>submitter<span class="" style="color: #ABB2BF;">,</span> ...<span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">proxyRefGen</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;event&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>
          type: <span class="string" style="color: #98C379;">&quot;form&quot;</span><span class="" style="color: #ABB2BF;">,</span>
          event: <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span>
          value: <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">,</span>
          cid: <span class="" style="color: #ABB2BF;">cid</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_REF</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">.</span>classList<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">contains</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;phx-submit-loading&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">meta</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">extractMeta</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">formData</span> <span class="operator" style="color: #C678DD;">=</span> <span class="function" style="color: #61AFEF;">serializeForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>submitter<span class="" style="color: #ABB2BF;">,</span> ...<span class="" style="color: #ABB2BF;">meta</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">refGenerator</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;event&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>
        type: <span class="string" style="color: #98C379;">&quot;form&quot;</span><span class="" style="color: #ABB2BF;">,</span>
        event: <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span>
        value: <span class="" style="color: #ABB2BF;">formData</span><span class="" style="color: #ABB2BF;">,</span>
        cid: <span class="" style="color: #ABB2BF;">cid</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onReply</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">uploadFiles</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">onComplete</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">joinCountAtUpload</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">inputEls</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">activeFileInputs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">formEl</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">numFileInputsInProgress</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">inputEls</span><span class="" style="color: #ABB2BF;">.</span>length

    <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; get each file input</span>
    <span class="" style="color: #ABB2BF;">inputEls</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">uploader</span> <span class="operator" style="color: #C678DD;">=</span> <span class="keyword" style="color: #E06C75;">new</span> <span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="" style="color: #ABB2BF;">numFileInputsInProgress</span><span class="operator" style="color: #C678DD;">--</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">numFileInputsInProgress</span> <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">onComplete</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">;</span>

      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>uploaders<span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">uploader</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">entries</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">uploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">entries</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">map</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">entry</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">entry</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">toPreflightPayload</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>

      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">payload</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span>
        ref: <span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_UPLOAD_REF</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">,</span>
        entries: <span class="" style="color: #ABB2BF;">entries</span><span class="" style="color: #ABB2BF;">,</span>
        cid: <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputEl</span><span class="" style="color: #ABB2BF;">.</span>form<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="" style="color: #ABB2BF;">}</span>

      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;upload&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;sending preflight request&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>

      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;allow_upload&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">payload</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;upload&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;got preflight response&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>error<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">undoRefs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">ref</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">entry_ref</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>error
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">log</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;upload&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">`error for entry <span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">entry_ref</span><span class="" style="color: #ABB2BF;">}</span>`</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">reason</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">onError</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>channel<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">onError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
              <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">===</span> <span class="" style="color: #ABB2BF;">joinCountAtUpload</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
            <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span>
          <span class="" style="color: #ABB2BF;">uploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">initAdapterUpload</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">onError</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">dispatchUploads</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">filesOrBlobs</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">targetElement</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetCtxElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">;</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">inputs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findUploadInputs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetElement</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>name <span class="operator" style="color: #C678DD;">===</span> <span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`no live file inputs found matching the name &quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">}</span>&quot;`</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 1<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="function" style="color: #61AFEF;">logError</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`duplicate live file inputs found matching the name &quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">name</span><span class="" style="color: #ABB2BF;">}</span>&quot;`</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
    <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">dispatchEvent</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">[</span>0<span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_TRACK_UPLOADS</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>detail: <span class="" style="color: #ABB2BF;">{</span>files: <span class="" style="color: #ABB2BF;">filesOrBlobs</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">targetCtxElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="function" style="color: #61AFEF;">isCid</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">target</span><span class="" style="color: #ABB2BF;">]</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findComponentNodeList</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">target</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">targetCtx</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushFormRecovery</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newCid</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">withinOwners</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxChange</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">inputs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">Array</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">from</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span>elements<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">isFormInput</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>name <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxChange</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">}</span>

      <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; we must clear tracked uploads before recovery as they no longer have valid refs</span>
      <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">hasAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_UPLOAD_REF</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="constructor" style="color: #61AFEF;">LiveUploader</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">clearFiles</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">input</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">find</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span>type <span class="operator" style="color: #C678DD;">!==</span> <span class="string" style="color: #98C379;">&quot;hidden&quot;</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">[</span>0<span class="" style="color: #ABB2BF;">]</span>

      <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxEvent</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_AUTO_RECOVER</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="constant" style="color: #56B6C2;">JS</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">exec</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">view</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">[</span><span class="string" style="color: #98C379;">&quot;push&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>_target: <span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">.</span>name<span class="" style="color: #ABB2BF;">,</span> newCid: <span class="" style="color: #ABB2BF;">newCid</span><span class="" style="color: #ABB2BF;">,</span> callback: <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">pushLinkPatch</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetEl</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">linkRef</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">setPendingLink</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">refGen</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">targetEl</span> ? <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putRef</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">targetEl</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;click&quot;</span><span class="" style="color: #ABB2BF;">)</span> : <span class="constant builtin" style="color: #D19A66;">null</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="function" style="color: #61AFEF;">fallback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">redirect</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">window</span><span class="" style="color: #ABB2BF;">.</span>location<span class="" style="color: #ABB2BF;">.</span>href<span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">url</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">startsWith</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;&#x2f;&quot;</span><span class="" style="color: #ABB2BF;">)</span> ? <span class="string" style="color: #98C379;">`<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">location</span><span class="" style="color: #ABB2BF;">.</span>protocol<span class="" style="color: #ABB2BF;">}</span>&#x2f;&#x2f;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">location</span><span class="" style="color: #ABB2BF;">.</span>host<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">}</span>`</span> : <span class="" style="color: #ABB2BF;">href</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">push</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">refGen</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;live_patch&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>url<span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">resp</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">requestDOMUpdate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>link_redirect<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">replaceMain</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">href</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">linkRef</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">commitPendingLink</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">linkRef</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>href <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">href</span>
          <span class="" style="color: #ABB2BF;">}</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">applyPendingUpdates</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">callback</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">callback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">linkRef</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">push</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">push</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">receive</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;timeout&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="function" style="color: #61AFEF;">fallback</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="function" style="color: #61AFEF;">fallback</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">formsForRecovery</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">html</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>joinCount <span class="operator" style="color: #C678DD;">===</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">]</span> <span class="" style="color: #ABB2BF;">}</span>

    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxChange</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;change&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">template</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">document</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">createElement</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">&quot;template&quot;</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">template</span><span class="" style="color: #ABB2BF;">.</span>innerHTML <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">html</span>

    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">(</span>
      <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">all</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">`form[<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxChange</span><span class="" style="color: #ABB2BF;">}</span>]`</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">ownsElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span>elements<span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_AUTO_RECOVER</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="string" style="color: #98C379;">&quot;ignore&quot;</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">map</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; attribute given via JS module needs to be escaped as it contains the symbols []&quot;,</span>
          <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; which result in an invalid css selector otherwise.</span>
          <span class="keyword" style="color: #E06C75;">const</span> <span class="" style="color: #ABB2BF;">phxChangeValue</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">phxChange</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">replaceAll</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;"><span class="operator" style="color: #C678DD;">&#x2f;</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">\[</span><span class="" style="color: #ABB2BF;">\]</span><span class="constant" style="color: #56B6C2;">&quot;</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span><span class="operator" style="color: #C678DD;">&#x2f;</span>g</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&#x27;\\$1&#x27;</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">newForm</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">template</span><span class="" style="color: #ABB2BF;">.</span>content<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">querySelector</span><span class="" style="color: #ABB2BF;">(</span><span class="string" style="color: #98C379;">`form[id=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">}</span>&quot;][<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxChange</span><span class="" style="color: #ABB2BF;">}</span>=&quot;<span class="" style="color: #ABB2BF;">${</span><span class="" style="color: #ABB2BF;">phxChangeValue</span><span class="" style="color: #ABB2BF;">}</span>&quot;]`</span><span class="" style="color: #ABB2BF;">)</span>
          <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
            <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span>
          <span class="" style="color: #ABB2BF;">}</span> <span class="keyword" style="color: #E06C75;">else</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">targetComponentID</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">]</span>
          <span class="" style="color: #ABB2BF;">}</span>
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">[</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">newCid</span><span class="" style="color: #ABB2BF;">]</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">newForm</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">maybePushComponentsDestroyed</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">destroyedCIDs</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">willDestroyCIDs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">destroyedCIDs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="keyword" style="color: #E06C75;">return</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findComponentNodeList</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">willDestroyCIDs</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pruningCIDs<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">push</span><span class="" style="color: #ABB2BF;">(</span>...<span class="" style="color: #ABB2BF;">willDestroyCIDs</span><span class="" style="color: #ABB2BF;">)</span>

      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;cids_will_destroy&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>cids: <span class="" style="color: #ABB2BF;">willDestroyCIDs</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
        <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; The cids are either back on the page or they will be fully removed,</span>
        <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; so we can remove them from the pruningCIDs.</span>
        <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pruningCIDs <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>pruningCIDs<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">willDestroyCIDs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">indexOf</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">!==</span> <span class="operator" style="color: #C678DD;">-</span>1<span class="" style="color: #ABB2BF;">)</span>

        <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; See if any of the cids we wanted to destroy were added back,</span>
        <span class="comment" style="font-style: italic; color: #5C6370;">&#x2f;&#x2f; if they were added back, we don&#x27;t actually destroy them.</span>
        <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">completelyDestroyCIDs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">willDestroyCIDs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">filter</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">cid</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
          <span class="keyword" style="color: #E06C75;">return</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">findComponentNodeList</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>el<span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">cid</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">===</span> 0
        <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>

        <span class="keyword" style="color: #E06C75;">if</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">completelyDestroyCIDs</span><span class="" style="color: #ABB2BF;">.</span>length <span class="operator" style="color: #C678DD;">&gt;</span> 0<span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
          <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushWithReply</span><span class="" style="color: #ABB2BF;">(</span><span class="constant builtin" style="color: #D19A66;">null</span><span class="" style="color: #ABB2BF;">,</span> <span class="string" style="color: #98C379;">&quot;cids_destroyed&quot;</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">{</span>cids: <span class="" style="color: #ABB2BF;">completelyDestroyCIDs</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
            <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>rendered<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pruneCIDs</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">resp</span><span class="" style="color: #ABB2BF;">.</span>cids<span class="" style="color: #ABB2BF;">)</span>
          <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
        <span class="" style="color: #ABB2BF;">}</span>
      <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">ownsElement</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">parentViewEl</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">closest</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_VIEW_SELECTOR</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">return</span> <span class="" style="color: #ABB2BF;">el</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">getAttribute</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_PARENT_ID</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">===</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">||</span>
      <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">parentViewEl</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="" style="color: #ABB2BF;">parentViewEl</span><span class="" style="color: #ABB2BF;">.</span>id <span class="operator" style="color: #C678DD;">===</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>id<span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">||</span>
      <span class="" style="color: #ABB2BF;">(</span><span class="operator" style="color: #C678DD;">!</span><span class="" style="color: #ABB2BF;">parentViewEl</span> <span class="operator" style="color: #C678DD;">&amp;&amp;</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>isDead<span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">submitForm</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span> <span class="operator" style="color: #C678DD;">=</span> <span class="" style="color: #ABB2BF;">{</span><span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span>
    <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putPrivate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_HAS_SUBMITTED</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">phxFeedback</span> <span class="operator" style="color: #C678DD;">=</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="constant" style="color: #56B6C2;">PHX_FEEDBACK_FOR</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="keyword" style="color: #E06C75;">let</span> <span class="" style="color: #ABB2BF;">inputs</span> <span class="operator" style="color: #C678DD;">=</span> <span class="constructor" style="color: #61AFEF;">Array</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">from</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">.</span>elements<span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">putPrivate</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant" style="color: #56B6C2;">PHX_HAS_SUBMITTED</span><span class="" style="color: #ABB2BF;">,</span> <span class="constant builtin" style="color: #D19A66;">true</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">blurActiveElement</span><span class="" style="color: #ABB2BF;">(</span><span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">pushFormSubmit</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">form</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">targetCtx</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxEvent</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">submitter</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">opts</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="" style="color: #ABB2BF;">{</span>
      <span class="" style="color: #ABB2BF;">inputs</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">forEach</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span> <span class="operator" style="color: #C678DD;">=&gt;</span> <span class="constant" style="color: #56B6C2;">DOM</span><span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">showError</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">input</span><span class="" style="color: #ABB2BF;">,</span> <span class="" style="color: #ABB2BF;">phxFeedback</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">)</span>
      <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">restorePreviouslyActiveFocus</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">)</span>
    <span class="" style="color: #ABB2BF;">}</span><span class="" style="color: #ABB2BF;">)</span>
  <span class="" style="color: #ABB2BF;">}</span>

  <span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">)</span><span class="" style="color: #ABB2BF;">{</span> <span class="keyword" style="color: #E06C75;">return</span> <span class="variable builtin" style="color: #61AFEF;">this</span><span class="" style="color: #ABB2BF;">.</span>liveSocket<span class="" style="color: #ABB2BF;">.</span><span class="function" style="color: #61AFEF;">binding</span><span class="" style="color: #ABB2BF;">(</span><span class="" style="color: #ABB2BF;">kind</span><span class="" style="color: #ABB2BF;">)</span> <span class="" style="color: #ABB2BF;">}</span>
<span class="" style="color: #ABB2BF;">}</span>

</code></pre>
</body>
</html>
